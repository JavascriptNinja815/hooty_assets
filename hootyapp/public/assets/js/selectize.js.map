{"version":3,"sources":["src/selectize.js"],"names":["root","factory","define","amd","exports","module","Sifter","items","settings","diacritics","prototype","tokenize","query","trim","String","toLowerCase","length","i","n","regex","letter","tokens","words","split","escape_regex","DIACRITICS","hasOwnProperty","replace","RegExp","push","string","iterator","object","callback","is_array","Array","forEach","key","apply","getScoreFunction","search","options","self","fields","token_count","nesting","prepareSearch","scoreValue","value","token","score","pos","scoreObject","field_count","data","getattr","sum","conjunction","getSortFunction","field","fields_count","multiplier","multipliers","get_field","implicit_score","sort","sort_empty","name","result","id","unshift","direction","splice","a","b","cmp","a_value","b_value","extend","option_fields","option_sort","option_sort_empty","total","calculateScore","fn_sort","fn_score","item","filter","limit","slice","asciifold","k","arguments","obj","names","shift","str","isArray","$","Object","toString","call","chunk","foreignletters","lookup","substring","charAt","regexp","foreignletter","MicroPlugin","mixin","Interface","plugins","initializePlugins","queue","requested","loaded","utils","require","loadPlugin","plugin","Error","fn","vArg","Selectize","jQuery","highlight","$element","pattern","node","skip","nodeType","match","spannode","document","createElement","className","middlebit","splitText","endbit","middleclone","cloneNode","appendChild","parentNode","replaceChild","childNodes","test","tagName","each","removeHighlight","find","firstChild","nodeName","parent","normalize","end","MicroEvent","on","event","fct","_events","off","indexOf","trigger","destObject","props","IS_MAC","navigator","userAgent","KEY_A","KEY_COMMA","KEY_RETURN","KEY_ESC","KEY_LEFT","KEY_UP","KEY_P","KEY_RIGHT","KEY_DOWN","KEY_N","KEY_BACKSPACE","KEY_DELETE","KEY_SHIFT","KEY_CMD","KEY_CTRL","KEY_TAB","TAG_SELECT","TAG_INPUT","SUPPORTS_VALIDITY_API","window","validity","isset","hash_key","escape_html","escape_replace","hook","before","method","original","after","once","called","debounce","delay","timeout","args","clearTimeout","setTimeout","debounce_events","types","type","event_args","watchChildEvent","$parent","selector","e","child","target","currentTarget","getSelection","input","start","selectionStart","selectionEnd","selection","focus","sel","createRange","selLen","text","moveStart","transferStyles","$from","$to","properties","styles","css","measureString","$testInput","position","top","left","width","padding","whiteSpace","appendTo","autoGrow","$input","currentWidth","update","keyCode","printable","placeholder","character","metaKey","altKey","force","val","shiftKey","fromCharCode","toUpperCase","attr","triggerHandler","domToString","d","tmp","innerHTML","logError","message","component","console","error","explanation","group","groupEnd","dir","selectize","computedStyle","getComputedStyle","getPropertyValue","currentStyle","parents","order","tabIndex","tagType","rtl","eventNS","count","highlightedValue","isBlurring","isOpen","isDisabled","isRequired","is","isInvalid","isLocked","isFocused","isInputHidden","isSetup","isShiftDown","isCmdDown","isCtrlDown","ignoreFocus","ignoreBlur","ignoreHover","hasOptions","currentResults","lastValue","caretPos","loading","loadedSearches","$activeOption","$activeItems","optgroups","userOptions","renderCache","onSearchChange","loadThrottle","sifter","registerOption","registerOptionGroup","mode","maxItems","hideSelected","setupCallbacks","setupTemplates","setup","$window","$document","$wrapper","$control","$control_input","$dropdown","$dropdown_content","$dropdown_parent","inputMode","timeout_blur","timeout_focus","classes","classes_plugins","inputId","addClass","wrapperClass","inputClass","dropdownParent","dropdownClass","hide","dropdownContentClass","copyClassesToDropdown","style","join","splitOn","delimiter","delimiterEscaped","stopImmediatePropagation","onOptionHover","onOptionSelect","onItemSelect","mousedown","onMouseDown","click","onClick","stopPropagation","keydown","onKeyDown","keyup","onKeyUp","keypress","onKeyPress","resize","positionDropdown","blur","onBlur","onFocus","paste","onPaste","has","revertSettings","$children","children","detach","tabindex","setValue","preventDefault","refreshState","updateOriginalInput","refreshItems","updatePlaceholder","disable","onChange","preload","field_label","labelField","field_optgroup","optgroupLabelField","templates","html","escape","render","callbacks","defaultPrevented","isDefaultPrevented","$target","close","open","setActiveItem","isFull","pastedText","splitInput","createItem","which","create","isInput","selectAll","ctrlKey","$next","getAdjacentOption","setActiveOption","$prev","advanceSelection","selectOnTab","deleteSelection","refreshOptions","load","wasFocused","showInput","openOnFocus","dest","activeElement","deactivate","setTextboxValue","setCaret","createOnBlur","$option","hasClass","closeAfterSelect","lastQuery","addItem","getOption","loadingClass","results","Math","max","addOption","removeClass","changed","getValue","silent","events","clear","addItems","$item","eventName","idx","begin","swap","$last","hideInput","scroll","animate","height_menu","height_item","y","scroll_top","scroll_bottom","height","outerHeight","scrollTop","offset","stop","scrollDuration","opacity","getSearchOptions","sortField","searchField","searchConjunction","triggerDropdown","j","groups","groups_order","option","option_html","optgroup","html_children","has_create_option","$active","$active_before","$create","active_before","maxOptions","min","optgroupField","createDocumentFragment","lockOptgroupOrder","a_order","$order","b_order","dom","canCreate","prepend","addPrecedence","valueField","optgroupValueField","addOptionGroup","removeOptionGroup","clearOptionGroups","updateOption","$item_new","value_new","index_item","cache_items","cache_options","order_old","getItem","replaceWith","removeOption","removeItem","clearOptions","getElementWithValue","$options","index","eq","$els","getAttribute","values","buffer","isPending","control","insertBefore","active","value_next","wasFull","insertAtCaret","remove","persist","caret","lock","unlock","output","refreshValidityState","refreshClasses","invalid","prop","toggleClass","isEmptyObject","opts","label","removeAttr","visibility","display","getBoundingClientRect","$el","el","option_select","$option_select","$tail","onDelete","pop","tail","valueLength","cursorAtEdge","advanceCaret","$adj","$child","append","enable","destroy","show","removeData","undefined","body","templateName","cache","regex_tag","disabledField","clearCache","createFilter","defaults","allowEmptyOption","dataAttr","settings_user","attr_data","field_value","field_disabled","field_optgroup_label","field_optgroup_value","init_textbox","settings_element","data_raw","JSON","parse","init_select","optionsMap","readData","arr","addGroup","$optgroup","instance","tag_name","support","sortable","forcePlaceholderSize","disabled","ui","helper","overflow","title","headerClass","titleRowClass","labelClass","closeClass","$dropdown_header","equalizeWidth","equalizeHeight","closest","prev","next","getScrollbarWidth","div","doc","offsetWidth","clientWidth","removeChild","equalizeSizes","height_max","width_last","width_parent","$optgroups","innerWidth","round","singleClose","thisRef","html_container","html_element","context","selectizer","render_item","multiClose"],"mappings":"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","sourcesContent":["/**\n * sifter.js\n * Copyright (c) 2013 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define('sifter', factory)\n  } else if (typeof exports === 'object') {\n    module.exports = factory()\n  } else {\n    root.Sifter = factory()\n  }\n})(this, function () {\n  /**\n   * Textually searches arrays and hashes of objects\n   * by property (or multiple properties). Designed\n   * specifically for autocomplete.\n   *\n   * @constructor\n   * @param {array|object} items\n   * @param {object} items\n   */\n  var Sifter = function (items, settings) {\n    this.items = items\n    this.settings = settings || {\n      diacritics: true\n    }\n  }\n  /**\n   * Splits a search string into an array of individual\n   * regexps to be used to match results.\n   *\n   * @param {string} query\n   * @returns {array}\n   */\n\n  Sifter.prototype.tokenize = function (query) {\n    query = trim(String(query || '').toLowerCase())\n    if (!query || !query.length) return []\n    var i, n, regex, letter\n    var tokens = []\n    var words = query.split(/ +/)\n\n    for (i = 0, n = words.length; i < n; i++) {\n      regex = escape_regex(words[i])\n\n      if (this.settings.diacritics) {\n        for (letter in DIACRITICS) {\n          if (DIACRITICS.hasOwnProperty(letter)) {\n            regex = regex.replace(new RegExp(letter, 'g'), DIACRITICS[letter])\n          }\n        }\n      }\n\n      tokens.push({\n        string: words[i],\n        regex: new RegExp(regex, 'i')\n      })\n    }\n\n    return tokens\n  }\n  /**\n   * Iterates over arrays and hashes.\n   *\n   * ```\n   * this.iterator(this.items, function(item, id) {\n   *    // invoked for each item\n   * });\n   * ```\n   *\n   * @param {array|object} object\n   */\n\n  Sifter.prototype.iterator = function (object, callback) {\n    var iterator\n\n    if (is_array(object)) {\n      iterator = Array.prototype.forEach || function (callback) {\n        for (var i = 0, n = this.length; i < n; i++) {\n          callback(this[i], i, this)\n        }\n      }\n    } else {\n      iterator = function (callback) {\n        for (var key in this) {\n          if (this.hasOwnProperty(key)) {\n            callback(this[key], key, this)\n          }\n        }\n      }\n    }\n\n    iterator.apply(object, [callback])\n  }\n  /**\n   * Returns a function to be used to score individual results.\n   *\n   * Good matches will have a higher score than poor matches.\n   * If an item is not a match, 0 will be returned by the function.\n   *\n   * @param {object|string} search\n   * @param {object} options (optional)\n   * @returns {function}\n   */\n\n  Sifter.prototype.getScoreFunction = function (search, options) {\n    var self, fields, tokens, token_count, nesting\n    self = this\n    search = self.prepareSearch(search, options)\n    tokens = search.tokens\n    fields = search.options.fields\n    token_count = tokens.length\n    nesting = search.options.nesting\n    /**\n     * Calculates how close of a match the\n     * given value is against a search token.\n     *\n     * @param {mixed} value\n     * @param {object} token\n     * @return {number}\n     */\n\n    var scoreValue = function (value, token) {\n      var score, pos\n      if (!value) return 0\n      value = String(value || '')\n      pos = value.search(token.regex)\n      if (pos === -1) return 0\n      score = token.string.length / value.length\n      if (pos === 0) score += 0.5\n      return score\n    }\n    /**\n     * Calculates the score of an object\n     * against the search query.\n     *\n     * @param {object} token\n     * @param {object} data\n     * @return {number}\n     */\n\n    var scoreObject = (function () {\n      var field_count = fields.length\n\n      if (!field_count) {\n        return function () {\n          return 0\n        }\n      }\n\n      if (field_count === 1) {\n        return function (token, data) {\n          return scoreValue(getattr(data, fields[0], nesting), token)\n        }\n      }\n\n      return function (token, data) {\n        for (var i = 0, sum = 0; i < field_count; i++) {\n          sum += scoreValue(getattr(data, fields[i], nesting), token)\n        }\n\n        return sum / field_count\n      }\n    }())\n\n    if (!token_count) {\n      return function () {\n        return 0\n      }\n    }\n\n    if (token_count === 1) {\n      return function (data) {\n        return scoreObject(tokens[0], data)\n      }\n    }\n\n    if (search.options.conjunction === 'and') {\n      return function (data) {\n        var score\n\n        for (var i = 0, sum = 0; i < token_count; i++) {\n          score = scoreObject(tokens[i], data)\n          if (score <= 0) return 0\n          sum += score\n        }\n\n        return sum / token_count\n      }\n    } else {\n      return function (data) {\n        for (var i = 0, sum = 0; i < token_count; i++) {\n          sum += scoreObject(tokens[i], data)\n        }\n\n        return sum / token_count\n      }\n    }\n  }\n  /**\n   * Returns a function that can be used to compare two\n   * results, for sorting purposes. If no sorting should\n   * be performed, `null` will be returned.\n   *\n   * @param {string|object} search\n   * @param {object} options\n   * @return function(a,b)\n   */\n\n  Sifter.prototype.getSortFunction = function (search, options) {\n    var i, n, self, field, fields, fields_count, multiplier, multipliers, get_field, implicit_score, sort\n    self = this\n    search = self.prepareSearch(search, options)\n    sort = !search.query && options.sort_empty || options.sort\n    /**\n     * Fetches the specified sort field value\n     * from a search result item.\n     *\n     * @param  {string} name\n     * @param  {object} result\n     * @return {mixed}\n     */\n\n    get_field = function (name, result) {\n      if (name === '$score') return result.score\n      return getattr(self.items[result.id], name, options.nesting)\n    } // parse options\n\n    fields = []\n\n    if (sort) {\n      for (i = 0, n = sort.length; i < n; i++) {\n        if (search.query || sort[i].field !== '$score') {\n          fields.push(sort[i])\n        }\n      }\n    } // the \"$score\" field is implied to be the primary\n    // sort field, unless it's manually specified\n\n    if (search.query) {\n      implicit_score = true\n\n      for (i = 0, n = fields.length; i < n; i++) {\n        if (fields[i].field === '$score') {\n          implicit_score = false\n          break\n        }\n      }\n\n      if (implicit_score) {\n        fields.unshift({\n          field: '$score',\n          direction: 'desc'\n        })\n      }\n    } else {\n      for (i = 0, n = fields.length; i < n; i++) {\n        if (fields[i].field === '$score') {\n          fields.splice(i, 1)\n          break\n        }\n      }\n    }\n\n    multipliers = []\n\n    for (i = 0, n = fields.length; i < n; i++) {\n      multipliers.push(fields[i].direction === 'desc' ? -1 : 1)\n    } // build function\n\n    fields_count = fields.length\n\n    if (!fields_count) {\n      return null\n    } else if (fields_count === 1) {\n      field = fields[0].field\n      multiplier = multipliers[0]\n      return function (a, b) {\n        return multiplier * cmp(get_field(field, a), get_field(field, b))\n      }\n    } else {\n      return function (a, b) {\n        var i, result, a_value, b_value, field\n\n        for (i = 0; i < fields_count; i++) {\n          field = fields[i].field\n          result = multipliers[i] * cmp(get_field(field, a), get_field(field, b))\n          if (result) return result\n        }\n\n        return 0\n      }\n    }\n  }\n  /**\n   * Parses a search query and returns an object\n   * with tokens and fields ready to be populated\n   * with results.\n   *\n   * @param {string} query\n   * @param {object} options\n   * @returns {object}\n   */\n\n  Sifter.prototype.prepareSearch = function (query, options) {\n    if (typeof query === 'object') return query\n    options = extend({}, options)\n    var option_fields = options.fields\n    var option_sort = options.sort\n    var option_sort_empty = options.sort_empty\n    if (option_fields && !is_array(option_fields)) options.fields = [option_fields]\n    if (option_sort && !is_array(option_sort)) options.sort = [option_sort]\n    if (option_sort_empty && !is_array(option_sort_empty)) options.sort_empty = [option_sort_empty]\n    return {\n      options: options,\n      query: String(query || '').toLowerCase(),\n      tokens: this.tokenize(query),\n      total: 0,\n      items: []\n    }\n  }\n  /**\n   * Searches through all items and returns a sorted array of matches.\n   *\n   * The `options` parameter can contain:\n   *\n   *   - fields {string|array}\n   *   - sort {array}\n   *   - score {function}\n   *   - filter {bool}\n   *   - limit {integer}\n   *\n   * Returns an object containing:\n   *\n   *   - options {object}\n   *   - query {string}\n   *   - tokens {array}\n   *   - total {int}\n   *   - items {array}\n   *\n   * @param {string} query\n   * @param {object} options\n   * @returns {object}\n   */\n\n  Sifter.prototype.search = function (query, options) {\n    var self = this\n\n    var value\n\n    var score\n\n    var search\n\n    var calculateScore\n    var fn_sort\n    var fn_score\n    search = this.prepareSearch(query, options)\n    options = search.options\n    query = search.query // generate result scoring function\n\n    fn_score = options.score || self.getScoreFunction(search) // perform search and sort\n\n    if (query.length) {\n      self.iterator(self.items, function (item, id) {\n        score = fn_score(item)\n\n        if (options.filter === false || score > 0) {\n          search.items.push({\n            'score': score,\n            'id': id\n          })\n        }\n      })\n    } else {\n      self.iterator(self.items, function (item, id) {\n        search.items.push({\n          'score': 1,\n          'id': id\n        })\n      })\n    }\n\n    fn_sort = self.getSortFunction(search, options)\n    if (fn_sort) search.items.sort(fn_sort) // apply limits\n\n    search.total = search.items.length\n\n    if (typeof options.limit === 'number') {\n      search.items = search.items.slice(0, options.limit)\n    }\n\n    return search\n  } // utilities\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  var cmp = function (a, b) {\n    if (typeof a === 'number' && typeof b === 'number') {\n      return a > b ? 1 : a < b ? -1 : 0\n    }\n\n    a = asciifold(String(a || ''))\n    b = asciifold(String(b || ''))\n    if (a > b) return 1\n    if (b > a) return -1\n    return 0\n  }\n\n  var extend = function (a, b) {\n    var i, n, k, object\n\n    for (i = 1, n = arguments.length; i < n; i++) {\n      object = arguments[i]\n      if (!object) continue\n\n      for (k in object) {\n        if (object.hasOwnProperty(k)) {\n          a[k] = object[k]\n        }\n      }\n    }\n\n    return a\n  }\n  /**\n   * A property getter resolving dot-notation\n   * @param  {Object}  obj     The root object to fetch property on\n   * @param  {String}  name    The optionally dotted property name to fetch\n   * @param  {Boolean} nesting Handle nesting or not\n   * @return {Object}          The resolved property value\n   */\n\n  var getattr = function (obj, name, nesting) {\n    if (!obj || !name) return\n    if (!nesting) return obj[name]\n    var names = name.split('.')\n\n    while (names.length && (obj = obj[names.shift()]));\n\n    return obj\n  }\n\n  var trim = function (str) {\n    return (str + '').replace(/^\\s+|\\s+$|/g, '')\n  }\n\n  var escape_regex = function (str) {\n    return (str + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1')\n  }\n\n  var is_array = Array.isArray || typeof $ !== 'undefined' && $.isArray || function (object) {\n    return Object.prototype.toString.call(object) === '[object Array]'\n  }\n\n  var DIACRITICS = {\n    'a': '[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]',\n    'b': '[b␢βΒB฿𐌁ᛒ]',\n    'c': '[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]',\n    'd': '[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]',\n    'e': '[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]',\n    'f': '[fƑƒḞḟ]',\n    'g': '[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]',\n    'h': '[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]',\n    'i': '[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]',\n    'j': '[jȷĴĵɈɉʝɟʲ]',\n    'k': '[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]',\n    'l': '[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]',\n    'n': '[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]',\n    'o': '[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]',\n    'p': '[pṔṕṖṗⱣᵽƤƥᵱ]',\n    'q': '[qꝖꝗʠɊɋꝘꝙq̃]',\n    'r': '[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]',\n    's': '[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]',\n    't': '[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]',\n    'u': '[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]',\n    'v': '[vṼṽṾṿƲʋꝞꝟⱱʋ]',\n    'w': '[wẂẃẀẁŴŵẄẅẆẇẈẉ]',\n    'x': '[xẌẍẊẋχ]',\n    'y': '[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]',\n    'z': '[zŹźẐẑŽžŻżẒẓẔẕƵƶ]'\n  }\n\n  var asciifold = (function () {\n    var i, n, k, chunk\n    var foreignletters = ''\n    var lookup = {}\n\n    for (k in DIACRITICS) {\n      if (DIACRITICS.hasOwnProperty(k)) {\n        chunk = DIACRITICS[k].substring(2, DIACRITICS[k].length - 1)\n        foreignletters += chunk\n\n        for (i = 0, n = chunk.length; i < n; i++) {\n          lookup[chunk.charAt(i)] = k\n        }\n      }\n    }\n\n    var regexp = new RegExp('[' + foreignletters + ']', 'g')\n    return function (str) {\n      return str.replace(regexp, function (foreignletter) {\n        return lookup[foreignletter]\n      }).toLowerCase()\n    }\n  }()) // export\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  return Sifter\n});\n/**\n * microplugin.js\n * Copyright (c) 2013 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define('microplugin', factory)\n  } else if (typeof exports === 'object') {\n    module.exports = factory()\n  } else {\n    root.MicroPlugin = factory()\n  }\n})(this, function () {\n  var MicroPlugin = {}\n\n  MicroPlugin.mixin = function (Interface) {\n    Interface.plugins = {}\n    /**\n     * Initializes the listed plugins (with options).\n     * Acceptable formats:\n     *\n     * List (without options):\n     *   ['a', 'b', 'c']\n     *\n     * List (with options):\n     *   [{'name': 'a', options: {}}, {'name': 'b', options: {}}]\n     *\n     * Hash (with options):\n     *   {'a': { ... }, 'b': { ... }, 'c': { ... }}\n     *\n     * @param {mixed} plugins\n     */\n\n    Interface.prototype.initializePlugins = function (plugins) {\n      var i, n, key\n      var self = this\n      var queue = []\n      self.plugins = {\n        names: [],\n        settings: {},\n        requested: {},\n        loaded: {}\n      }\n\n      if (utils.isArray(plugins)) {\n        for (i = 0, n = plugins.length; i < n; i++) {\n          if (typeof plugins[i] === 'string') {\n            queue.push(plugins[i])\n          } else {\n            self.plugins.settings[plugins[i].name] = plugins[i].options\n            queue.push(plugins[i].name)\n          }\n        }\n      } else if (plugins) {\n        for (key in plugins) {\n          if (plugins.hasOwnProperty(key)) {\n            self.plugins.settings[key] = plugins[key]\n            queue.push(key)\n          }\n        }\n      }\n\n      while (queue.length) {\n        self.require(queue.shift())\n      }\n    }\n\n    Interface.prototype.loadPlugin = function (name) {\n      var self = this\n      var plugins = self.plugins\n      var plugin = Interface.plugins[name]\n\n      if (!Interface.plugins.hasOwnProperty(name)) {\n        throw new Error('Unable to find \"' + name + '\" plugin')\n      }\n\n      plugins.requested[name] = true\n      plugins.loaded[name] = plugin.fn.apply(self, [self.plugins.settings[name] || {}])\n      plugins.names.push(name)\n    }\n    /**\n     * Initializes a plugin.\n     *\n     * @param {string} name\n     */\n\n    Interface.prototype.require = function (name) {\n      var self = this\n      var plugins = self.plugins\n\n      if (!self.plugins.loaded.hasOwnProperty(name)) {\n        if (plugins.requested[name]) {\n          throw new Error('Plugin has circular dependency (\"' + name + '\")')\n        }\n\n        self.loadPlugin(name)\n      }\n\n      return plugins.loaded[name]\n    }\n    /**\n     * Registers a plugin.\n     *\n     * @param {string} name\n     * @param {function} fn\n     */\n\n    Interface.define = function (name, fn) {\n      Interface.plugins[name] = {\n        'name': name,\n        'fn': fn\n      }\n    }\n  }\n\n  var utils = {\n    isArray: Array.isArray || function (vArg) {\n      return Object.prototype.toString.call(vArg) === '[object Array]'\n    }\n  }\n  return MicroPlugin\n});\n/**\n * selectize.js (v0.12.6)\n * Copyright (c) 2013–2015 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\n/* jshint curly:false */\n\n/* jshint browser:true */\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define('selectize', ['jquery', 'sifter', 'microplugin'], factory)\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('jquery'), require('sifter'), require('microplugin'))\n  } else {\n    root.Selectize = factory(root.jQuery, root.Sifter, root.MicroPlugin)\n  }\n})(this, function ($, Sifter, MicroPlugin) {\n  'use strict'\n\n  var highlight = function ($element, pattern) {\n    if (typeof pattern === 'string' && !pattern.length) return\n    var regex = typeof pattern === 'string' ? new RegExp(pattern, 'i') : pattern\n\n    var highlight = function (node) {\n      var skip = 0 // Wrap matching part of text node with highlighting <span>, e.g.\n      // Soccer  ->  <span class=\"highlight\">Soc</span>cer  for regex = /soc/i\n\n      if (node.nodeType === 3) {\n        var pos = node.data.search(regex)\n\n        if (pos >= 0 && node.data.length > 0) {\n          var match = node.data.match(regex)\n          var spannode = document.createElement('span')\n          spannode.className = 'highlight'\n          var middlebit = node.splitText(pos)\n          var endbit = middlebit.splitText(match[0].length)\n          var middleclone = middlebit.cloneNode(true)\n          spannode.appendChild(middleclone)\n          middlebit.parentNode.replaceChild(spannode, middlebit)\n          skip = 1\n        }\n      } // Recurse element node, looking for child text nodes to highlight, unless element\n      // is childless, <script>, <style>, or already highlighted: <span class=\"hightlight\">\n      else if (node.nodeType === 1 && node.childNodes && !/(script|style)/i.test(node.tagName) && (node.className !== 'highlight' || node.tagName !== 'SPAN')) {\n        for (var i = 0; i < node.childNodes.length; ++i) {\n          i += highlight(node.childNodes[i])\n        }\n      }\n\n      return skip\n    }\n\n    return $element.each(function () {\n      highlight(this)\n    })\n  }\n  /**\n   * removeHighlight fn copied from highlight v5 and\n   * edited to remove with() and pass js strict mode\n   */\n\n  $.fn.removeHighlight = function () {\n    return this.find('span.highlight').each(function () {\n      this.parentNode.firstChild.nodeName\n      var parent = this.parentNode\n      parent.replaceChild(this.firstChild, this)\n      parent.normalize()\n    }).end()\n  }\n\n  var MicroEvent = function () {}\n\n  MicroEvent.prototype = {\n    on: function (event, fct) {\n      this._events = this._events || {}\n      this._events[event] = this._events[event] || []\n\n      this._events[event].push(fct)\n    },\n    off: function (event, fct) {\n      var n = arguments.length\n      if (n === 0) return delete this._events\n      if (n === 1) return delete this._events[event]\n      this._events = this._events || {}\n      if (event in this._events === false) return\n\n      this._events[event].splice(this._events[event].indexOf(fct), 1)\n    },\n    trigger: function (event\n    /* , args... */\n    ) {\n      this._events = this._events || {}\n      if (event in this._events === false) return\n\n      for (var i = 0; i < this._events[event].length; i++) {\n        this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1))\n      }\n    }\n  }\n  /**\n   * Mixin will delegate all MicroEvent.js function in the destination object.\n   *\n   * - MicroEvent.mixin(Foobar) will make Foobar able to use MicroEvent\n   *\n   * @param {object} the object which will support MicroEvent\n   */\n\n  MicroEvent.mixin = function (destObject) {\n    var props = ['on', 'off', 'trigger']\n\n    for (var i = 0; i < props.length; i++) {\n      destObject.prototype[props[i]] = MicroEvent.prototype[props[i]]\n    }\n  }\n\n  var IS_MAC = /Mac/.test(navigator.userAgent)\n  var KEY_A = 65\n  var KEY_COMMA = 188\n  var KEY_RETURN = 13\n  var KEY_ESC = 27\n  var KEY_LEFT = 37\n  var KEY_UP = 38\n  var KEY_P = 80\n  var KEY_RIGHT = 39\n  var KEY_DOWN = 40\n  var KEY_N = 78\n  var KEY_BACKSPACE = 8\n  var KEY_DELETE = 46\n  var KEY_SHIFT = 16\n  var KEY_CMD = IS_MAC ? 91 : 17\n  var KEY_CTRL = IS_MAC ? 18 : 17\n  var KEY_TAB = 9\n  var TAG_SELECT = 1\n  var TAG_INPUT = 2 // for now, android support in general is too spotty to support validity\n\n  var SUPPORTS_VALIDITY_API = !/android/i.test(window.navigator.userAgent) && !!document.createElement('input').validity\n\n  var isset = function (object) {\n    return typeof object !== 'undefined'\n  }\n  /**\n   * Converts a scalar to its best string representation\n   * for hash keys and HTML attribute values.\n   *\n   * Transformations:\n   *   'str'     -> 'str'\n   *   null      -> ''\n   *   undefined -> ''\n   *   true      -> '1'\n   *   false     -> '0'\n   *   0         -> '0'\n   *   1         -> '1'\n   *\n   * @param {string} value\n   * @returns {string|null}\n   */\n\n  var hash_key = function (value) {\n    if (typeof value === 'undefined' || value === null) return null\n    if (typeof value === 'boolean') return value ? '1' : '0'\n    return value + ''\n  }\n  /**\n   * Escapes a string for use within HTML.\n   *\n   * @param {string} str\n   * @returns {string}\n   */\n\n  var escape_html = function (str) {\n    return (str + '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\n  }\n  /**\n   * Escapes \"$\" characters in replacement strings.\n   *\n   * @param {string} str\n   * @returns {string}\n   */\n\n  var escape_replace = function (str) {\n    return (str + '').replace(/\\$/g, '$$$$')\n  }\n\n  var hook = {}\n  /**\n   * Wraps `method` on `self` so that `fn`\n   * is invoked before the original method.\n   *\n   * @param {object} self\n   * @param {string} method\n   * @param {function} fn\n   */\n\n  hook.before = function (self, method, fn) {\n    var original = self[method]\n\n    self[method] = function () {\n      fn.apply(self, arguments)\n      return original.apply(self, arguments)\n    }\n  }\n  /**\n   * Wraps `method` on `self` so that `fn`\n   * is invoked after the original method.\n   *\n   * @param {object} self\n   * @param {string} method\n   * @param {function} fn\n   */\n\n  hook.after = function (self, method, fn) {\n    var original = self[method]\n\n    self[method] = function () {\n      var result = original.apply(self, arguments)\n      fn.apply(self, arguments)\n      return result\n    }\n  }\n  /**\n   * Wraps `fn` so that it can only be invoked once.\n   *\n   * @param {function} fn\n   * @returns {function}\n   */\n\n  var once = function (fn) {\n    var called = false\n    return function () {\n      if (called) return\n      called = true\n      fn.apply(this, arguments)\n    }\n  }\n  /**\n   * Wraps `fn` so that it can only be called once\n   * every `delay` milliseconds (invoked on the falling edge).\n   *\n   * @param {function} fn\n   * @param {int} delay\n   * @returns {function}\n   */\n\n  var debounce = function (fn, delay) {\n    var timeout\n    return function () {\n      var self = this\n      var args = arguments\n      window.clearTimeout(timeout)\n      timeout = window.setTimeout(function () {\n        fn.apply(self, args)\n      }, delay)\n    }\n  }\n  /**\n   * Debounce all fired events types listed in `types`\n   * while executing the provided `fn`.\n   *\n   * @param {object} self\n   * @param {array} types\n   * @param {function} fn\n   */\n\n  var debounce_events = function (self, types, fn) {\n    var type\n    var trigger = self.trigger\n    var event_args = {} // override trigger method\n\n    self.trigger = function () {\n      var type = arguments[0]\n\n      if (types.indexOf(type) !== -1) {\n        event_args[type] = arguments\n      } else {\n        return trigger.apply(self, arguments)\n      }\n    } // invoke provided function\n\n    fn.apply(self, [])\n    self.trigger = trigger // trigger queued events\n\n    for (type in event_args) {\n      if (event_args.hasOwnProperty(type)) {\n        trigger.apply(self, event_args[type])\n      }\n    }\n  }\n  /**\n   * A workaround for http://bugs.jquery.com/ticket/6696\n   *\n   * @param {object} $parent - Parent element to listen on.\n   * @param {string} event - Event name.\n   * @param {string} selector - Descendant selector to filter by.\n   * @param {function} fn - Event handler.\n   */\n\n  var watchChildEvent = function ($parent, event, selector, fn) {\n    $parent.on(event, selector, function (e) {\n      var child = e.target\n\n      while (child && child.parentNode !== $parent[0]) {\n        child = child.parentNode\n      }\n\n      e.currentTarget = child\n      return fn.apply(this, [e])\n    })\n  }\n  /**\n   * Determines the current selection within a text input control.\n   * Returns an object containing:\n   *   - start\n   *   - length\n   *\n   * @param {object} input\n   * @returns {object}\n   */\n\n  var getSelection = function (input) {\n    var result = {}\n\n    if ('selectionStart' in input) {\n      result.start = input.selectionStart\n      result.length = input.selectionEnd - result.start\n    } else if (document.selection) {\n      input.focus()\n      var sel = document.selection.createRange()\n      var selLen = document.selection.createRange().text.length\n      sel.moveStart('character', -input.value.length)\n      result.start = sel.text.length - selLen\n      result.length = selLen\n    }\n\n    return result\n  }\n  /**\n   * Copies CSS properties from one element to another.\n   *\n   * @param {object} $from\n   * @param {object} $to\n   * @param {array} properties\n   */\n\n  var transferStyles = function ($from, $to, properties) {\n    var i\n\n    var n\n\n    var styles = {}\n\n    if (properties) {\n      for (i = 0, n = properties.length; i < n; i++) {\n        styles[properties[i]] = $from.css(properties[i])\n      }\n    } else {\n      styles = $from.css()\n    }\n\n    $to.css(styles)\n  }\n  /**\n   * Measures the width of a string within a\n   * parent element (in pixels).\n   *\n   * @param {string} str\n   * @param {object} $parent\n   * @returns {int}\n   */\n\n  var measureString = function (str, $parent) {\n    if (!str) {\n      return 0\n    }\n\n    if (!Selectize.$testInput) {\n      Selectize.$testInput = $('<span />').css({\n        position: 'absolute',\n        top: -99999,\n        left: -99999,\n        width: 'auto',\n        padding: 0,\n        whiteSpace: 'pre'\n      }).appendTo('body')\n    }\n\n    Selectize.$testInput.text(str)\n    transferStyles($parent, Selectize.$testInput, ['letterSpacing', 'fontSize', 'fontFamily', 'fontWeight', 'textTransform'])\n    return Selectize.$testInput.width()\n  }\n  /**\n   * Sets up an input to grow horizontally as the user\n   * types. If the value is changed manually, you can\n   * trigger the \"update\" handler to resize:\n   *\n   * $input.trigger('update');\n   *\n   * @param {object} $input\n   */\n\n  var autoGrow = function ($input) {\n    var currentWidth = null\n\n    var update = function (e, options) {\n      var value, keyCode, printable, placeholder, width\n      var shift, character, selection\n      e = e || window.event || {}\n      options = options || {}\n      if (e.metaKey || e.altKey) return\n      if (!options.force && $input.data('grow') === false) return\n      value = $input.val()\n\n      if (e.type && e.type.toLowerCase() === 'keydown') {\n        keyCode = e.keyCode\n        printable = keyCode >= 48 && keyCode <= 57 || // 0-9\n        keyCode >= 65 && keyCode <= 90 || // a-z\n        keyCode >= 96 && keyCode <= 111 || // numpad 0-9, numeric operators\n        keyCode >= 186 && keyCode <= 222 || // semicolon, equal, comma, dash, etc.\n        keyCode === 32 // space\n\n        if (keyCode === KEY_DELETE || keyCode === KEY_BACKSPACE) {\n          selection = getSelection($input[0])\n\n          if (selection.length) {\n            value = value.substring(0, selection.start) + value.substring(selection.start + selection.length)\n          } else if (keyCode === KEY_BACKSPACE && selection.start) {\n            value = value.substring(0, selection.start - 1) + value.substring(selection.start + 1)\n          } else if (keyCode === KEY_DELETE && typeof selection.start !== 'undefined') {\n            value = value.substring(0, selection.start) + value.substring(selection.start + 1)\n          }\n        } else if (printable) {\n          shift = e.shiftKey\n          character = String.fromCharCode(e.keyCode)\n          if (shift) character = character.toUpperCase(); else character = character.toLowerCase()\n          value += character\n        }\n      }\n\n      placeholder = $input.attr('placeholder')\n\n      if (!value && placeholder) {\n        value = placeholder\n      }\n\n      width = measureString(value, $input) + 4\n\n      if (width !== currentWidth) {\n        currentWidth = width\n        $input.width(width)\n        $input.triggerHandler('resize')\n      }\n    }\n\n    $input.on('keydown keyup update blur', update)\n    update()\n  }\n\n  var domToString = function (d) {\n    var tmp = document.createElement('div')\n    tmp.appendChild(d.cloneNode(true))\n    return tmp.innerHTML\n  }\n\n  var logError = function (message, options) {\n    if (!options) options = {}\n    var component = 'Selectize'\n    console.error(component + ': ' + message)\n\n    if (options.explanation) {\n      // console.group is undefined in <IE11\n      if (console.group) console.group()\n      console.error(options.explanation)\n      if (console.group) console.groupEnd()\n    }\n  }\n\n  var Selectize = function ($input, settings) {\n    var key\n\n    var i\n\n    var n\n\n    var dir\n\n    var input\n\n    var self = this\n    input = $input[0]\n    input.selectize = self // detect rtl environment\n\n    var computedStyle = window.getComputedStyle && window.getComputedStyle(input, null)\n    dir = computedStyle ? computedStyle.getPropertyValue('direction') : input.currentStyle && input.currentStyle.direction\n    dir = dir || $input.parents('[dir]:first').attr('dir') || '' // setup default state\n\n    $.extend(self, {\n      order: 0,\n      settings: settings,\n      $input: $input,\n      tabIndex: $input.attr('tabindex') || '',\n      tagType: input.tagName.toLowerCase() === 'select' ? TAG_SELECT : TAG_INPUT,\n      rtl: /rtl/i.test(dir),\n      eventNS: '.selectize' + ++Selectize.count,\n      highlightedValue: null,\n      isBlurring: false,\n      isOpen: false,\n      isDisabled: false,\n      isRequired: $input.is('[required]'),\n      isInvalid: false,\n      isLocked: false,\n      isFocused: false,\n      isInputHidden: false,\n      isSetup: false,\n      isShiftDown: false,\n      isCmdDown: false,\n      isCtrlDown: false,\n      ignoreFocus: false,\n      ignoreBlur: false,\n      ignoreHover: false,\n      hasOptions: false,\n      currentResults: null,\n      lastValue: '',\n      caretPos: 0,\n      loading: 0,\n      loadedSearches: {},\n      $activeOption: null,\n      $activeItems: [],\n      optgroups: {},\n      options: {},\n      userOptions: {},\n      items: [],\n      renderCache: {},\n      onSearchChange: settings.loadThrottle === null ? self.onSearchChange : debounce(self.onSearchChange, settings.loadThrottle)\n    }) // search system\n\n    self.sifter = new Sifter(this.options, {\n      diacritics: settings.diacritics\n    }) // build options table\n\n    if (self.settings.options) {\n      for (i = 0, n = self.settings.options.length; i < n; i++) {\n        self.registerOption(self.settings.options[i])\n      }\n\n      delete self.settings.options\n    } // build optgroup table\n\n    if (self.settings.optgroups) {\n      for (i = 0, n = self.settings.optgroups.length; i < n; i++) {\n        self.registerOptionGroup(self.settings.optgroups[i])\n      }\n\n      delete self.settings.optgroups\n    } // option-dependent defaults\n\n    self.settings.mode = self.settings.mode || (self.settings.maxItems === 1 ? 'single' : 'multi')\n\n    if (typeof self.settings.hideSelected !== 'boolean') {\n      self.settings.hideSelected = self.settings.mode === 'multi'\n    }\n\n    self.initializePlugins(self.settings.plugins)\n    self.setupCallbacks()\n    self.setupTemplates()\n    self.setup()\n  } // mixins\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  MicroEvent.mixin(Selectize)\n\n  if (typeof MicroPlugin !== 'undefined') {\n    MicroPlugin.mixin(Selectize)\n  } else {\n    logError('Dependency MicroPlugin is missing', {\n      explanation: 'Make sure you either: (1) are using the \"standalone\" ' + 'version of Selectize, or (2) require MicroPlugin before you ' + 'load Selectize.'\n    })\n  } // methods\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  $.extend(Selectize.prototype, {\n    /**\n     * Creates all elements and sets up event bindings.\n     */\n    setup: function () {\n      var self = this\n      var settings = self.settings\n      var eventNS = self.eventNS\n      var $window = $(window)\n      var $document = $(document)\n      var $input = self.$input\n      var $wrapper\n      var $control\n      var $control_input\n      var $dropdown\n      var $dropdown_content\n      var $dropdown_parent\n      var inputMode\n      var timeout_blur\n      var timeout_focus\n      var classes\n      var classes_plugins\n      var inputId\n      inputMode = self.settings.mode\n      classes = $input.attr('class') || ''\n      $wrapper = $('<div>').addClass(settings.wrapperClass).addClass(classes).addClass(inputMode)\n      $control = $('<div>').addClass(settings.inputClass).addClass('items').appendTo($wrapper)\n      $control_input = $('<input type=\"text\" autocomplete=\"off\" />').appendTo($control).attr('tabindex', $input.is(':disabled') ? '-1' : self.tabIndex)\n      $dropdown_parent = $(settings.dropdownParent || $wrapper)\n      $dropdown = $('<div>').addClass(settings.dropdownClass).addClass(inputMode).hide().appendTo($dropdown_parent)\n      $dropdown_content = $('<div>').addClass(settings.dropdownContentClass).appendTo($dropdown)\n\n      if (inputId = $input.attr('id')) {\n        $control_input.attr('id', inputId + '-selectized')\n        $(\"label[for='\" + inputId + \"']\").attr('for', inputId + '-selectized')\n      }\n\n      if (self.settings.copyClassesToDropdown) {\n        $dropdown.addClass(classes)\n      }\n\n      $wrapper.css({\n        width: $input[0].style.width\n      })\n\n      if (self.plugins.names.length) {\n        classes_plugins = 'plugin-' + self.plugins.names.join(' plugin-')\n        $wrapper.addClass(classes_plugins)\n        $dropdown.addClass(classes_plugins)\n      }\n\n      if ((settings.maxItems === null || settings.maxItems > 1) && self.tagType === TAG_SELECT) {\n        $input.attr('multiple', 'multiple')\n      }\n\n      if (self.settings.placeholder) {\n        $control_input.attr('placeholder', settings.placeholder)\n      } // if splitOn was not passed in, construct it from the delimiter to allow pasting universally\n\n      if (!self.settings.splitOn && self.settings.delimiter) {\n        var delimiterEscaped = self.settings.delimiter.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n        self.settings.splitOn = new RegExp('\\\\s*' + delimiterEscaped + '+\\\\s*')\n      }\n\n      if ($input.attr('autocorrect')) {\n        $control_input.attr('autocorrect', $input.attr('autocorrect'))\n      }\n\n      if ($input.attr('autocapitalize')) {\n        $control_input.attr('autocapitalize', $input.attr('autocapitalize'))\n      }\n\n      $control_input[0].type = $input[0].type\n      self.$wrapper = $wrapper\n      self.$control = $control\n      self.$control_input = $control_input\n      self.$dropdown = $dropdown\n      self.$dropdown_content = $dropdown_content\n      $dropdown.on('mouseenter mousedown click', '[data-disabled]>[data-selectable]', function (e) {\n        e.stopImmediatePropagation()\n      })\n      $dropdown.on('mouseenter', '[data-selectable]', function () {\n        return self.onOptionHover.apply(self, arguments)\n      })\n      $dropdown.on('mousedown click', '[data-selectable]', function () {\n        return self.onOptionSelect.apply(self, arguments)\n      })\n      watchChildEvent($control, 'mousedown', '*:not(input)', function () {\n        return self.onItemSelect.apply(self, arguments)\n      })\n      autoGrow($control_input)\n      $control.on({\n        mousedown: function () {\n          return self.onMouseDown.apply(self, arguments)\n        },\n        click: function () {\n          return self.onClick.apply(self, arguments)\n        }\n      })\n      $control_input.on({\n        mousedown: function (e) {\n          e.stopPropagation()\n        },\n        keydown: function () {\n          return self.onKeyDown.apply(self, arguments)\n        },\n        keyup: function () {\n          return self.onKeyUp.apply(self, arguments)\n        },\n        keypress: function () {\n          return self.onKeyPress.apply(self, arguments)\n        },\n        resize: function () {\n          self.positionDropdown.apply(self, [])\n        },\n        blur: function () {\n          return self.onBlur.apply(self, arguments)\n        },\n        focus: function () {\n          self.ignoreBlur = false\n          return self.onFocus.apply(self, arguments)\n        },\n        paste: function () {\n          return self.onPaste.apply(self, arguments)\n        }\n      })\n      $document.on('keydown' + eventNS, function (e) {\n        self.isCmdDown = e[IS_MAC ? 'metaKey' : 'ctrlKey']\n        self.isCtrlDown = e[IS_MAC ? 'altKey' : 'ctrlKey']\n        self.isShiftDown = e.shiftKey\n      })\n      $document.on('keyup' + eventNS, function (e) {\n        if (e.keyCode === KEY_CTRL) self.isCtrlDown = false\n        if (e.keyCode === KEY_SHIFT) self.isShiftDown = false\n        if (e.keyCode === KEY_CMD) self.isCmdDown = false\n      })\n      $document.on('mousedown' + eventNS, function (e) {\n        if (self.isFocused) {\n          // prevent events on the dropdown scrollbar from causing the control to blur\n          if (e.target === self.$dropdown[0] || e.target.parentNode === self.$dropdown[0]) {\n            return false\n          } // blur on click outside\n\n          if (!self.$control.has(e.target).length && e.target !== self.$control[0]) {\n            self.blur(e.target)\n          }\n        }\n      })\n      $window.on(['scroll' + eventNS, 'resize' + eventNS].join(' '), function () {\n        if (self.isOpen) {\n          self.positionDropdown.apply(self, arguments)\n        }\n      })\n      $window.on('mousemove' + eventNS, function () {\n        self.ignoreHover = false\n      }) // store original children and tab index so that they can be\n      // restored when the destroy() method is called.\n\n      this.revertSettings = {\n        $children: $input.children().detach(),\n        tabindex: $input.attr('tabindex')\n      }\n      $input.attr('tabindex', -1).hide().after(self.$wrapper)\n\n      if ($.isArray(settings.items)) {\n        self.setValue(settings.items)\n        delete settings.items\n      } // feature detect for the validation API\n\n      if (SUPPORTS_VALIDITY_API) {\n        $input.on('invalid' + eventNS, function (e) {\n          e.preventDefault()\n          self.isInvalid = true\n          self.refreshState()\n        })\n      }\n\n      self.updateOriginalInput()\n      self.refreshItems()\n      self.refreshState()\n      self.updatePlaceholder()\n      self.isSetup = true\n\n      if ($input.is(':disabled')) {\n        self.disable()\n      }\n\n      self.on('change', this.onChange)\n      $input.data('selectize', self)\n      $input.addClass('selectized')\n      self.trigger('initialize') // preload options\n\n      if (settings.preload === true) {\n        self.onSearchChange('')\n      }\n    },\n\n    /**\n     * Sets up default rendering functions.\n     */\n    setupTemplates: function () {\n      var self = this\n      var field_label = self.settings.labelField\n      var field_optgroup = self.settings.optgroupLabelField\n      var templates = {\n        'optgroup': function (data) {\n          return '<div class=\"optgroup\">' + data.html + '</div>'\n        },\n        'optgroup_header': function (data, escape) {\n          return '<div class=\"optgroup-header\">' + escape(data[field_optgroup]) + '</div>'\n        },\n        'option': function (data, escape) {\n          return '<div class=\"option\">' + escape(data[field_label]) + '</div>'\n        },\n        'item': function (data, escape) {\n          return '<div class=\"item\">' + escape(data[field_label]) + '</div>'\n        },\n        'option_create': function (data, escape) {\n          return '<div class=\"create\">Add <strong>' + escape(data.input) + '</strong>&hellip;</div>'\n        }\n      }\n      self.settings.render = $.extend({}, templates, self.settings.render)\n    },\n\n    /**\n     * Maps fired events to callbacks provided\n     * in the settings used when creating the control.\n     */\n    setupCallbacks: function () {\n      var key\n\n      var fn\n\n      var callbacks = {\n        'initialize': 'onInitialize',\n        'change': 'onChange',\n        'item_add': 'onItemAdd',\n        'item_remove': 'onItemRemove',\n        'clear': 'onClear',\n        'option_add': 'onOptionAdd',\n        'option_remove': 'onOptionRemove',\n        'option_clear': 'onOptionClear',\n        'optgroup_add': 'onOptionGroupAdd',\n        'optgroup_remove': 'onOptionGroupRemove',\n        'optgroup_clear': 'onOptionGroupClear',\n        'dropdown_open': 'onDropdownOpen',\n        'dropdown_close': 'onDropdownClose',\n        'type': 'onType',\n        'load': 'onLoad',\n        'focus': 'onFocus',\n        'blur': 'onBlur'\n      }\n\n      for (key in callbacks) {\n        if (callbacks.hasOwnProperty(key)) {\n          fn = this.settings[callbacks[key]]\n          if (fn) this.on(key, fn)\n        }\n      }\n    },\n\n    /**\n     * Triggered when the main control element\n     * has a click event.\n     *\n     * @param {object} e\n     * @return {boolean}\n     */\n    onClick: function (e) {\n      var self = this // necessary for mobile webkit devices (manual focus triggering\n      // is ignored unless invoked within a click event)\n      // also necessary to reopen a dropdown that has been closed by\n      // closeAfterSelect\n\n      if (!self.isFocused || !self.isOpen) {\n        self.focus()\n        e.preventDefault()\n      }\n    },\n\n    /**\n     * Triggered when the main control element\n     * has a mouse down event.\n     *\n     * @param {object} e\n     * @return {boolean}\n     */\n    onMouseDown: function (e) {\n      var self = this\n      var defaultPrevented = e.isDefaultPrevented()\n      var $target = $(e.target)\n\n      if (self.isFocused) {\n        // retain focus by preventing native handling. if the\n        // event target is the input it should not be modified.\n        // otherwise, text selection within the input won't work.\n        if (e.target !== self.$control_input[0]) {\n          if (self.settings.mode === 'single') {\n            // toggle dropdown\n            self.isOpen ? self.close() : self.open()\n          } else if (!defaultPrevented) {\n            self.setActiveItem(null)\n          }\n\n          return false\n        }\n      } else {\n        // give control focus\n        if (!defaultPrevented) {\n          window.setTimeout(function () {\n            self.focus()\n          }, 0)\n        }\n      }\n    },\n\n    /**\n     * Triggered when the value of the control has been changed.\n     * This should propagate the event to the original DOM\n     * input / select element.\n     */\n    onChange: function () {\n      this.$input.trigger('change')\n    },\n\n    /**\n     * Triggered on <input> paste.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onPaste: function (e) {\n      var self = this\n\n      if (self.isFull() || self.isInputHidden || self.isLocked) {\n        e.preventDefault()\n        return\n      } // If a regex or string is included, this will split the pasted\n      // input and create Items for each separate value\n\n      if (self.settings.splitOn) {\n        // Wait for pasted text to be recognized in value\n        setTimeout(function () {\n          var pastedText = self.$control_input.val()\n\n          if (!pastedText.match(self.settings.splitOn)) {\n            return\n          }\n\n          var splitInput = $.trim(pastedText).split(self.settings.splitOn)\n\n          for (var i = 0, n = splitInput.length; i < n; i++) {\n            self.createItem(splitInput[i])\n          }\n        }, 0)\n      }\n    },\n\n    /**\n     * Triggered on <input> keypress.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onKeyPress: function (e) {\n      if (this.isLocked) return e && e.preventDefault()\n      var character = String.fromCharCode(e.keyCode || e.which)\n\n      if (this.settings.create && this.settings.mode === 'multi' && character === this.settings.delimiter) {\n        this.createItem()\n        e.preventDefault()\n        return false\n      }\n    },\n\n    /**\n     * Triggered on <input> keydown.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onKeyDown: function (e) {\n      var isInput = e.target === this.$control_input[0]\n      var self = this\n\n      if (self.isLocked) {\n        if (e.keyCode !== KEY_TAB) {\n          e.preventDefault()\n        }\n\n        return\n      }\n\n      switch (e.keyCode) {\n        case KEY_A:\n          if (self.isCmdDown) {\n            self.selectAll()\n            return\n          }\n\n          break\n\n        case KEY_ESC:\n          if (self.isOpen) {\n            e.preventDefault()\n            e.stopPropagation()\n            self.close()\n          }\n\n          return\n\n        case KEY_N:\n          if (!e.ctrlKey || e.altKey) break\n\n        case KEY_DOWN:\n          if (!self.isOpen && self.hasOptions) {\n            self.open()\n          } else if (self.$activeOption) {\n            self.ignoreHover = true\n            var $next = self.getAdjacentOption(self.$activeOption, 1)\n            if ($next.length) self.setActiveOption($next, true, true)\n          }\n\n          e.preventDefault()\n          return\n\n        case KEY_P:\n          if (!e.ctrlKey || e.altKey) break\n\n        case KEY_UP:\n          if (self.$activeOption) {\n            self.ignoreHover = true\n            var $prev = self.getAdjacentOption(self.$activeOption, -1)\n            if ($prev.length) self.setActiveOption($prev, true, true)\n          }\n\n          e.preventDefault()\n          return\n\n        case KEY_RETURN:\n          if (self.isOpen && self.$activeOption) {\n            self.onOptionSelect({\n              currentTarget: self.$activeOption\n            })\n            e.preventDefault()\n          }\n\n          return\n\n        case KEY_LEFT:\n          self.advanceSelection(-1, e)\n          return\n\n        case KEY_RIGHT:\n          self.advanceSelection(1, e)\n          return\n\n        case KEY_TAB:\n          if (self.settings.selectOnTab && self.isOpen && self.$activeOption) {\n            self.onOptionSelect({\n              currentTarget: self.$activeOption\n            }) // Default behaviour is to jump to the next field, we only want this\n            // if the current field doesn't accept any more entries\n\n            if (!self.isFull()) {\n              e.preventDefault()\n            }\n          }\n\n          if (self.settings.create && self.createItem()) {\n            e.preventDefault()\n          }\n\n          return\n\n        case KEY_BACKSPACE:\n        case KEY_DELETE:\n          self.deleteSelection(e)\n          return\n      }\n\n      if ((self.isFull() || self.isInputHidden) && !(IS_MAC ? e.metaKey : e.ctrlKey)) {\n        e.preventDefault()\n      }\n    },\n\n    /**\n     * Triggered on <input> keyup.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onKeyUp: function (e) {\n      var self = this\n      if (self.isLocked) return e && e.preventDefault()\n      var value = self.$control_input.val() || ''\n\n      if (self.lastValue !== value) {\n        self.lastValue = value\n        self.onSearchChange(value)\n        self.refreshOptions()\n        self.trigger('type', value)\n      }\n    },\n\n    /**\n     * Invokes the user-provide option provider / loader.\n     *\n     * Note: this function is debounced in the Selectize\n     * constructor (by `settings.loadThrottle` milliseconds)\n     *\n     * @param {string} value\n     */\n    onSearchChange: function (value) {\n      var self = this\n      var fn = self.settings.load\n      if (!fn) return\n      if (self.loadedSearches.hasOwnProperty(value)) return\n      self.loadedSearches[value] = true\n      self.load(function (callback) {\n        fn.apply(self, [value, callback])\n      })\n    },\n\n    /**\n     * Triggered on <input> focus.\n     *\n     * @param {object} e (optional)\n     * @returns {boolean}\n     */\n    onFocus: function (e) {\n      var self = this\n      var wasFocused = self.isFocused\n\n      if (self.isDisabled) {\n        self.blur()\n        e && e.preventDefault()\n        return false\n      }\n\n      if (self.ignoreFocus) return\n      self.isFocused = true\n      if (self.settings.preload === 'focus') self.onSearchChange('')\n      if (!wasFocused) self.trigger('focus')\n\n      if (!self.$activeItems.length) {\n        self.showInput()\n        self.setActiveItem(null)\n        self.refreshOptions(!!self.settings.openOnFocus)\n      }\n\n      self.refreshState()\n    },\n\n    /**\n     * Triggered on <input> blur.\n     *\n     * @param {object} e\n     * @param {Element} dest\n     */\n    onBlur: function (e, dest) {\n      var self = this\n      if (!self.isFocused) return\n      self.isFocused = false\n\n      if (self.ignoreFocus) {\n        return\n      } else if (!self.ignoreBlur && document.activeElement === self.$dropdown_content[0]) {\n        // necessary to prevent IE closing the dropdown when the scrollbar is clicked\n        self.ignoreBlur = true\n        self.onFocus(e)\n        return\n      }\n\n      var deactivate = function () {\n        self.close()\n        self.setTextboxValue('')\n        self.setActiveItem(null)\n        self.setActiveOption(null)\n        self.setCaret(self.items.length)\n        self.refreshState() // IE11 bug: element still marked as active\n\n        dest && dest.focus && dest.focus()\n        self.isBlurring = false\n        self.ignoreFocus = false\n        self.trigger('blur')\n      }\n\n      self.isBlurring = true\n      self.ignoreFocus = true\n\n      if (self.settings.create && self.settings.createOnBlur) {\n        self.createItem(null, false, deactivate)\n      } else {\n        deactivate()\n      }\n    },\n\n    /**\n     * Triggered when the user rolls over\n     * an option in the autocomplete dropdown menu.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onOptionHover: function (e) {\n      if (this.ignoreHover) return\n      this.setActiveOption(e.currentTarget, false)\n    },\n\n    /**\n     * Triggered when the user clicks on an option\n     * in the autocomplete dropdown menu.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onOptionSelect: function (e) {\n      var value\n\n      var $target\n\n      var $option\n\n      var self = this\n\n      if (e.preventDefault) {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n\n      $target = $(e.currentTarget)\n\n      if ($target.hasClass('create')) {\n        self.createItem(null, function () {\n          if (self.settings.closeAfterSelect) {\n            self.close()\n          }\n        })\n      } else {\n        value = $target.attr('data-value')\n\n        if (typeof value !== 'undefined') {\n          self.lastQuery = null\n          self.setTextboxValue('')\n          self.addItem(value)\n\n          if (self.settings.closeAfterSelect) {\n            self.close()\n          } else if (!self.settings.hideSelected && e.type && /mouse/.test(e.type)) {\n            self.setActiveOption(self.getOption(value))\n          }\n        }\n      }\n    },\n\n    /**\n     * Triggered when the user clicks on an item\n     * that has been selected.\n     *\n     * @param {object} e\n     * @returns {boolean}\n     */\n    onItemSelect: function (e) {\n      var self = this\n      if (self.isLocked) return\n\n      if (self.settings.mode === 'multi') {\n        e.preventDefault()\n        self.setActiveItem(e.currentTarget, e)\n      }\n    },\n\n    /**\n     * Invokes the provided method that provides\n     * results to a callback---which are then added\n     * as options to the control.\n     *\n     * @param {function} fn\n     */\n    load: function (fn) {\n      var self = this\n      var $wrapper = self.$wrapper.addClass(self.settings.loadingClass)\n      self.loading++\n      fn.apply(self, [function (results) {\n        self.loading = Math.max(self.loading - 1, 0)\n\n        if (results && results.length) {\n          self.addOption(results)\n          self.refreshOptions(self.isFocused && !self.isInputHidden)\n        }\n\n        if (!self.loading) {\n          $wrapper.removeClass(self.settings.loadingClass)\n        }\n\n        self.trigger('load', results)\n      }])\n    },\n\n    /**\n     * Sets the input field of the control to the specified value.\n     *\n     * @param {string} value\n     */\n    setTextboxValue: function (value) {\n      var $input = this.$control_input\n      var changed = $input.val() !== value\n\n      if (changed) {\n        $input.val(value).triggerHandler('update')\n        this.lastValue = value\n      }\n    },\n\n    /**\n     * Returns the value of the control. If multiple items\n     * can be selected (e.g. <select multiple>), this returns\n     * an array. If only one item can be selected, this\n     * returns a string.\n     *\n     * @returns {mixed}\n     */\n    getValue: function () {\n      if (this.tagType === TAG_SELECT && this.$input.attr('multiple')) {\n        return this.items\n      } else {\n        return this.items.join(this.settings.delimiter)\n      }\n    },\n\n    /**\n     * Resets the selected items to the given value.\n     *\n     * @param {mixed} value\n     */\n    setValue: function (value, silent) {\n      var events = silent ? [] : ['change']\n      debounce_events(this, events, function () {\n        this.clear(silent)\n        this.addItems(value, silent)\n      })\n    },\n\n    /**\n     * Sets the selected item.\n     *\n     * @param {object} $item\n     * @param {object} e (optional)\n     */\n    setActiveItem: function ($item, e) {\n      var self = this\n      var eventName\n      var i, idx, begin, end, item, swap\n      var $last\n      if (self.settings.mode === 'single') return\n      $item = $($item) // clear the active selection\n\n      if (!$item.length) {\n        $(self.$activeItems).removeClass('active')\n        self.$activeItems = []\n\n        if (self.isFocused) {\n          self.showInput()\n        }\n\n        return\n      } // modify selection\n\n      eventName = e && e.type.toLowerCase()\n\n      if (eventName === 'mousedown' && self.isShiftDown && self.$activeItems.length) {\n        $last = self.$control.children('.active:last')\n        begin = Array.prototype.indexOf.apply(self.$control[0].childNodes, [$last[0]])\n        end = Array.prototype.indexOf.apply(self.$control[0].childNodes, [$item[0]])\n\n        if (begin > end) {\n          swap = begin\n          begin = end\n          end = swap\n        }\n\n        for (i = begin; i <= end; i++) {\n          item = self.$control[0].childNodes[i]\n\n          if (self.$activeItems.indexOf(item) === -1) {\n            $(item).addClass('active')\n            self.$activeItems.push(item)\n          }\n        }\n\n        e.preventDefault()\n      } else if (eventName === 'mousedown' && self.isCtrlDown || eventName === 'keydown' && this.isShiftDown) {\n        if ($item.hasClass('active')) {\n          idx = self.$activeItems.indexOf($item[0])\n          self.$activeItems.splice(idx, 1)\n          $item.removeClass('active')\n        } else {\n          self.$activeItems.push($item.addClass('active')[0])\n        }\n      } else {\n        $(self.$activeItems).removeClass('active')\n        self.$activeItems = [$item.addClass('active')[0]]\n      } // ensure control has focus\n\n      self.hideInput()\n\n      if (!this.isFocused) {\n        self.focus()\n      }\n    },\n\n    /**\n     * Sets the selected item in the dropdown menu\n     * of available options.\n     *\n     * @param {object} $object\n     * @param {boolean} scroll\n     * @param {boolean} animate\n     */\n    setActiveOption: function ($option, scroll, animate) {\n      var height_menu, height_item, y\n      var scroll_top, scroll_bottom\n      var self = this\n      if (self.$activeOption) self.$activeOption.removeClass('active')\n      self.$activeOption = null\n      $option = $($option)\n      if (!$option.length) return\n      self.$activeOption = $option.addClass('active')\n\n      if (scroll || !isset(scroll)) {\n        height_menu = self.$dropdown_content.height()\n        height_item = self.$activeOption.outerHeight(true)\n        scroll = self.$dropdown_content.scrollTop() || 0\n        y = self.$activeOption.offset().top - self.$dropdown_content.offset().top + scroll\n        scroll_top = y\n        scroll_bottom = y - height_menu + height_item\n\n        if (y + height_item > height_menu + scroll) {\n          self.$dropdown_content.stop().animate({\n            scrollTop: scroll_bottom\n          }, animate ? self.settings.scrollDuration : 0)\n        } else if (y < scroll) {\n          self.$dropdown_content.stop().animate({\n            scrollTop: scroll_top\n          }, animate ? self.settings.scrollDuration : 0)\n        }\n      }\n    },\n\n    /**\n     * Selects all items (CTRL + A).\n     */\n    selectAll: function () {\n      var self = this\n      if (self.settings.mode === 'single') return\n      self.$activeItems = Array.prototype.slice.apply(self.$control.children(':not(input)').addClass('active'))\n\n      if (self.$activeItems.length) {\n        self.hideInput()\n        self.close()\n      }\n\n      self.focus()\n    },\n\n    /**\n     * Hides the input element out of view, while\n     * retaining its focus.\n     */\n    hideInput: function () {\n      var self = this\n      self.setTextboxValue('')\n      self.$control_input.css({\n        opacity: 0,\n        position: 'absolute',\n        left: self.rtl ? 10000 : -10000\n      })\n      self.isInputHidden = true\n    },\n\n    /**\n     * Restores input visibility.\n     */\n    showInput: function () {\n      this.$control_input.css({\n        opacity: 1,\n        position: 'relative',\n        left: 0\n      })\n      this.isInputHidden = false\n    },\n\n    /**\n     * Gives the control focus.\n     */\n    focus: function () {\n      var self = this\n      if (self.isDisabled) return\n      self.ignoreFocus = true\n      self.$control_input[0].focus()\n      window.setTimeout(function () {\n        self.ignoreFocus = false\n        self.onFocus()\n      }, 0)\n    },\n\n    /**\n     * Forces the control out of focus.\n     *\n     * @param {Element} dest\n     */\n    blur: function (dest) {\n      this.$control_input[0].blur()\n      this.onBlur(null, dest)\n    },\n\n    /**\n     * Returns a function that scores an object\n     * to show how good of a match it is to the\n     * provided query.\n     *\n     * @param {string} query\n     * @param {object} options\n     * @return {function}\n     */\n    getScoreFunction: function (query) {\n      return this.sifter.getScoreFunction(query, this.getSearchOptions())\n    },\n\n    /**\n     * Returns search options for sifter (the system\n     * for scoring and sorting results).\n     *\n     * @see https://github.com/brianreavis/sifter.js\n     * @return {object}\n     */\n    getSearchOptions: function () {\n      var settings = this.settings\n      var sort = settings.sortField\n\n      if (typeof sort === 'string') {\n        sort = [{\n          field: sort\n        }]\n      }\n\n      return {\n        fields: settings.searchField,\n        conjunction: settings.searchConjunction,\n        sort: sort,\n        nesting: settings.nesting\n      }\n    },\n\n    /**\n     * Searches through available options and returns\n     * a sorted array of matches.\n     *\n     * Returns an object containing:\n     *\n     *   - query {string}\n     *   - tokens {array}\n     *   - total {int}\n     *   - items {array}\n     *\n     * @param {string} query\n     * @returns {object}\n     */\n    search: function (query) {\n      var i, value, score, result, calculateScore\n      var self = this\n      var settings = self.settings\n      var options = this.getSearchOptions() // validate user-provided result scoring function\n\n      if (settings.score) {\n        calculateScore = self.settings.score.apply(this, [query])\n\n        if (typeof calculateScore !== 'function') {\n          throw new Error('Selectize \"score\" setting must be a function that returns a function')\n        }\n      } // perform search\n\n      if (query !== self.lastQuery) {\n        self.lastQuery = query\n        result = self.sifter.search(query, $.extend(options, {\n          score: calculateScore\n        }))\n        self.currentResults = result\n      } else {\n        result = $.extend(true, {}, self.currentResults)\n      } // filter out selected items\n\n      if (settings.hideSelected) {\n        for (i = result.items.length - 1; i >= 0; i--) {\n          if (self.items.indexOf(hash_key(result.items[i].id)) !== -1) {\n            result.items.splice(i, 1)\n          }\n        }\n      }\n\n      return result\n    },\n\n    /**\n     * Refreshes the list of available options shown\n     * in the autocomplete dropdown menu.\n     *\n     * @param {boolean} triggerDropdown\n     */\n    refreshOptions: function (triggerDropdown) {\n      var i, j, k, n, groups, groups_order, option, option_html, optgroup, optgroups, html, html_children, has_create_option\n      var $active, $active_before, $create\n\n      if (typeof triggerDropdown === 'undefined') {\n        triggerDropdown = true\n      }\n\n      var self = this\n      var query = $.trim(self.$control_input.val())\n      var results = self.search(query)\n      var $dropdown_content = self.$dropdown_content\n      var active_before = self.$activeOption && hash_key(self.$activeOption.attr('data-value')) // build markup\n\n      n = results.items.length\n\n      if (typeof self.settings.maxOptions === 'number') {\n        n = Math.min(n, self.settings.maxOptions)\n      } // render and group available options individually\n\n      groups = {}\n      groups_order = []\n\n      for (i = 0; i < n; i++) {\n        option = self.options[results.items[i].id]\n        option_html = self.render('option', option)\n        optgroup = option[self.settings.optgroupField] || ''\n        optgroups = $.isArray(optgroup) ? optgroup : [optgroup]\n\n        for (j = 0, k = optgroups && optgroups.length; j < k; j++) {\n          optgroup = optgroups[j]\n\n          if (!self.optgroups.hasOwnProperty(optgroup)) {\n            optgroup = ''\n          }\n\n          if (!groups.hasOwnProperty(optgroup)) {\n            groups[optgroup] = document.createDocumentFragment()\n            groups_order.push(optgroup)\n          }\n\n          groups[optgroup].appendChild(option_html)\n        }\n      } // sort optgroups\n\n      if (this.settings.lockOptgroupOrder) {\n        groups_order.sort(function (a, b) {\n          var a_order = self.optgroups[a].$order || 0\n          var b_order = self.optgroups[b].$order || 0\n          return a_order - b_order\n        })\n      } // render optgroup headers & join groups\n\n      html = document.createDocumentFragment()\n\n      for (i = 0, n = groups_order.length; i < n; i++) {\n        optgroup = groups_order[i]\n\n        if (self.optgroups.hasOwnProperty(optgroup) && groups[optgroup].childNodes.length) {\n          // render the optgroup header and options within it,\n          // then pass it to the wrapper template\n          html_children = document.createDocumentFragment()\n          html_children.appendChild(self.render('optgroup_header', self.optgroups[optgroup]))\n          html_children.appendChild(groups[optgroup])\n          html.appendChild(self.render('optgroup', $.extend({}, self.optgroups[optgroup], {\n            html: domToString(html_children),\n            dom: html_children\n          })))\n        } else {\n          html.appendChild(groups[optgroup])\n        }\n      }\n\n      $dropdown_content.html(html) // highlight matching terms inline\n\n      if (self.settings.highlight) {\n        $dropdown_content.removeHighlight()\n\n        if (results.query.length && results.tokens.length) {\n          for (i = 0, n = results.tokens.length; i < n; i++) {\n            highlight($dropdown_content, results.tokens[i].regex)\n          }\n        }\n      } // add \"selected\" class to selected options\n\n      if (!self.settings.hideSelected) {\n        for (i = 0, n = self.items.length; i < n; i++) {\n          self.getOption(self.items[i]).addClass('selected')\n        }\n      } // add create option\n\n      has_create_option = self.canCreate(query)\n\n      if (has_create_option) {\n        $dropdown_content.prepend(self.render('option_create', {\n          input: query\n        }))\n        $create = $($dropdown_content[0].childNodes[0])\n      } // activate\n\n      self.hasOptions = results.items.length > 0 || has_create_option\n\n      if (self.hasOptions) {\n        if (results.items.length > 0) {\n          $active_before = active_before && self.getOption(active_before)\n\n          if ($active_before && $active_before.length) {\n            $active = $active_before\n          } else if (self.settings.mode === 'single' && self.items.length) {\n            $active = self.getOption(self.items[0])\n          }\n\n          if (!$active || !$active.length) {\n            if ($create && !self.settings.addPrecedence) {\n              $active = self.getAdjacentOption($create, 1)\n            } else {\n              $active = $dropdown_content.find('[data-selectable]:first')\n            }\n          }\n        } else {\n          $active = $create\n        }\n\n        self.setActiveOption($active)\n\n        if (triggerDropdown && !self.isOpen) {\n          self.open()\n        }\n      } else {\n        self.setActiveOption(null)\n\n        if (triggerDropdown && self.isOpen) {\n          self.close()\n        }\n      }\n    },\n\n    /**\n     * Adds an available option. If it already exists,\n     * nothing will happen. Note: this does not refresh\n     * the options list dropdown (use `refreshOptions`\n     * for that).\n     *\n     * Usage:\n     *\n     *   this.addOption(data)\n     *\n     * @param {object|array} data\n     */\n    addOption: function (data) {\n      var i\n\n      var n\n\n      var value\n\n      var self = this\n\n      if ($.isArray(data)) {\n        for (i = 0, n = data.length; i < n; i++) {\n          self.addOption(data[i])\n        }\n\n        return\n      }\n\n      if (value = self.registerOption(data)) {\n        self.userOptions[value] = true\n        self.lastQuery = null\n        self.trigger('option_add', value, data)\n      }\n    },\n\n    /**\n     * Registers an option to the pool of options.\n     *\n     * @param {object} data\n     * @return {boolean|string}\n     */\n    registerOption: function (data) {\n      var key = hash_key(data[this.settings.valueField])\n      if (typeof key === 'undefined' || key === null || this.options.hasOwnProperty(key)) return false\n      data.$order = data.$order || ++this.order\n      this.options[key] = data\n      return key\n    },\n\n    /**\n     * Registers an option group to the pool of option groups.\n     *\n     * @param {object} data\n     * @return {boolean|string}\n     */\n    registerOptionGroup: function (data) {\n      var key = hash_key(data[this.settings.optgroupValueField])\n      if (!key) return false\n      data.$order = data.$order || ++this.order\n      this.optgroups[key] = data\n      return key\n    },\n\n    /**\n     * Registers a new optgroup for options\n     * to be bucketed into.\n     *\n     * @param {string} id\n     * @param {object} data\n     */\n    addOptionGroup: function (id, data) {\n      data[this.settings.optgroupValueField] = id\n\n      if (id = this.registerOptionGroup(data)) {\n        this.trigger('optgroup_add', id, data)\n      }\n    },\n\n    /**\n     * Removes an existing option group.\n     *\n     * @param {string} id\n     */\n    removeOptionGroup: function (id) {\n      if (this.optgroups.hasOwnProperty(id)) {\n        delete this.optgroups[id]\n        this.renderCache = {}\n        this.trigger('optgroup_remove', id)\n      }\n    },\n\n    /**\n     * Clears all existing option groups.\n     */\n    clearOptionGroups: function () {\n      this.optgroups = {}\n      this.renderCache = {}\n      this.trigger('optgroup_clear')\n    },\n\n    /**\n     * Updates an option available for selection. If\n     * it is visible in the selected items or options\n     * dropdown, it will be re-rendered automatically.\n     *\n     * @param {string} value\n     * @param {object} data\n     */\n    updateOption: function (value, data) {\n      var self = this\n      var $item, $item_new\n      var value_new, index_item, cache_items, cache_options, order_old\n      value = hash_key(value)\n      value_new = hash_key(data[self.settings.valueField]) // sanity checks\n\n      if (value === null) return\n      if (!self.options.hasOwnProperty(value)) return\n      if (typeof value_new !== 'string') throw new Error('Value must be set in option data')\n      order_old = self.options[value].$order // update references\n\n      if (value_new !== value) {\n        delete self.options[value]\n        index_item = self.items.indexOf(value)\n\n        if (index_item !== -1) {\n          self.items.splice(index_item, 1, value_new)\n        }\n      }\n\n      data.$order = data.$order || order_old\n      self.options[value_new] = data // invalidate render cache\n\n      cache_items = self.renderCache['item']\n      cache_options = self.renderCache['option']\n\n      if (cache_items) {\n        delete cache_items[value]\n        delete cache_items[value_new]\n      }\n\n      if (cache_options) {\n        delete cache_options[value]\n        delete cache_options[value_new]\n      } // update the item if it's selected\n\n      if (self.items.indexOf(value_new) !== -1) {\n        $item = self.getItem(value)\n        $item_new = $(self.render('item', data))\n        if ($item.hasClass('active')) $item_new.addClass('active')\n        $item.replaceWith($item_new)\n      } // invalidate last query because we might have updated the sortField\n\n      self.lastQuery = null // update dropdown contents\n\n      if (self.isOpen) {\n        self.refreshOptions(false)\n      }\n    },\n\n    /**\n     * Removes a single option.\n     *\n     * @param {string} value\n     * @param {boolean} silent\n     */\n    removeOption: function (value, silent) {\n      var self = this\n      value = hash_key(value)\n      var cache_items = self.renderCache['item']\n      var cache_options = self.renderCache['option']\n      if (cache_items) delete cache_items[value]\n      if (cache_options) delete cache_options[value]\n      delete self.userOptions[value]\n      delete self.options[value]\n      self.lastQuery = null\n      self.trigger('option_remove', value)\n      self.removeItem(value, silent)\n    },\n\n    /**\n     * Clears all options.\n     */\n    clearOptions: function () {\n      var self = this\n      self.loadedSearches = {}\n      self.userOptions = {}\n      self.renderCache = {}\n      var options = self.options\n      $.each(self.options, function (key, value) {\n        if (self.items.indexOf(key) == -1) {\n          delete options[key]\n        }\n      })\n      self.options = self.sifter.items = options\n      self.lastQuery = null\n      self.trigger('option_clear')\n    },\n\n    /**\n     * Returns the jQuery element of the option\n     * matching the given value.\n     *\n     * @param {string} value\n     * @returns {object}\n     */\n    getOption: function (value) {\n      return this.getElementWithValue(value, this.$dropdown_content.find('[data-selectable]'))\n    },\n\n    /**\n     * Returns the jQuery element of the next or\n     * previous selectable option.\n     *\n     * @param {object} $option\n     * @param {int} direction  can be 1 for next or -1 for previous\n     * @return {object}\n     */\n    getAdjacentOption: function ($option, direction) {\n      var $options = this.$dropdown.find('[data-selectable]')\n      var index = $options.index($option) + direction\n      return index >= 0 && index < $options.length ? $options.eq(index) : $()\n    },\n\n    /**\n     * Finds the first element with a \"data-value\" attribute\n     * that matches the given value.\n     *\n     * @param {mixed} value\n     * @param {object} $els\n     * @return {object}\n     */\n    getElementWithValue: function (value, $els) {\n      value = hash_key(value)\n\n      if (typeof value !== 'undefined' && value !== null) {\n        for (var i = 0, n = $els.length; i < n; i++) {\n          if ($els[i].getAttribute('data-value') === value) {\n            return $($els[i])\n          }\n        }\n      }\n\n      return $()\n    },\n\n    /**\n     * Returns the jQuery element of the item\n     * matching the given value.\n     *\n     * @param {string} value\n     * @returns {object}\n     */\n    getItem: function (value) {\n      return this.getElementWithValue(value, this.$control.children())\n    },\n\n    /**\n     * \"Selects\" multiple items at once. Adds them to the list\n     * at the current caret position.\n     *\n     * @param {string} value\n     * @param {boolean} silent\n     */\n    addItems: function (values, silent) {\n      this.buffer = document.createDocumentFragment()\n      var childNodes = this.$control[0].childNodes\n\n      for (var i = 0; i < childNodes.length; i++) {\n        this.buffer.appendChild(childNodes[i])\n      }\n\n      var items = $.isArray(values) ? values : [values]\n\n      for (var i = 0, n = items.length; i < n; i++) {\n        this.isPending = i < n - 1\n        this.addItem(items[i], silent)\n      }\n\n      var control = this.$control[0]\n      control.insertBefore(this.buffer, control.firstChild)\n      this.buffer = null\n    },\n\n    /**\n     * \"Selects\" an item. Adds it to the list\n     * at the current caret position.\n     *\n     * @param {string} value\n     * @param {boolean} silent\n     */\n    addItem: function (value, silent) {\n      var events = silent ? [] : ['change']\n      debounce_events(this, events, function () {\n        var $item, $option, $options\n        var self = this\n        var inputMode = self.settings.mode\n        var i, active, value_next, wasFull\n        value = hash_key(value)\n\n        if (self.items.indexOf(value) !== -1) {\n          if (inputMode === 'single') self.close()\n          return\n        }\n\n        if (!self.options.hasOwnProperty(value)) return\n        if (inputMode === 'single') self.clear(silent)\n        if (inputMode === 'multi' && self.isFull()) return\n        $item = $(self.render('item', self.options[value]))\n        wasFull = self.isFull()\n        self.items.splice(self.caretPos, 0, value)\n        self.insertAtCaret($item)\n\n        if (!self.isPending || !wasFull && self.isFull()) {\n          self.refreshState()\n        }\n\n        if (self.isSetup) {\n          $options = self.$dropdown_content.find('[data-selectable]') // update menu / remove the option (if this is not one item being added as part of series)\n\n          if (!self.isPending) {\n            $option = self.getOption(value)\n            value_next = self.getAdjacentOption($option, 1).attr('data-value')\n            self.refreshOptions(self.isFocused && inputMode !== 'single')\n\n            if (value_next) {\n              self.setActiveOption(self.getOption(value_next))\n            }\n          } // hide the menu if the maximum number of items have been selected or no options are left\n\n          if (!$options.length || self.isFull()) {\n            self.close()\n          } else if (!self.isPending) {\n            self.positionDropdown()\n          }\n\n          self.updatePlaceholder()\n          self.trigger('item_add', value, $item)\n\n          if (!self.isPending) {\n            self.updateOriginalInput({\n              silent: silent\n            })\n          }\n        }\n      })\n    },\n\n    /**\n     * Removes the selected item matching\n     * the provided value.\n     *\n     * @param {string} value\n     */\n    removeItem: function (value, silent) {\n      var self = this\n      var $item, i, idx\n      $item = value instanceof $ ? value : self.getItem(value)\n      value = hash_key($item.attr('data-value'))\n      i = self.items.indexOf(value)\n\n      if (i !== -1) {\n        $item.remove()\n\n        if ($item.hasClass('active')) {\n          idx = self.$activeItems.indexOf($item[0])\n          self.$activeItems.splice(idx, 1)\n        }\n\n        self.items.splice(i, 1)\n        self.lastQuery = null\n\n        if (!self.settings.persist && self.userOptions.hasOwnProperty(value)) {\n          self.removeOption(value, silent)\n        }\n\n        if (i < self.caretPos) {\n          self.setCaret(self.caretPos - 1)\n        }\n\n        self.refreshState()\n        self.updatePlaceholder()\n        self.updateOriginalInput({\n          silent: silent\n        })\n        self.positionDropdown()\n        self.trigger('item_remove', value, $item)\n      }\n    },\n\n    /**\n     * Invokes the `create` method provided in the\n     * selectize options that should provide the data\n     * for the new item, given the user input.\n     *\n     * Once this completes, it will be added\n     * to the item list.\n     *\n     * @param {string} value\n     * @param {boolean} [triggerDropdown]\n     * @param {function} [callback]\n     * @return {boolean}\n     */\n    createItem: function (input, triggerDropdown) {\n      var self = this\n      var caret = self.caretPos\n      input = input || $.trim(self.$control_input.val() || '')\n      var callback = arguments[arguments.length - 1]\n      if (typeof callback !== 'function') callback = function () {}\n\n      if (typeof triggerDropdown !== 'boolean') {\n        triggerDropdown = true\n      }\n\n      if (!self.canCreate(input)) {\n        callback()\n        return false\n      }\n\n      self.lock()\n      var setup = typeof self.settings.create === 'function' ? this.settings.create : function (input) {\n        var data = {}\n        data[self.settings.labelField] = input\n        data[self.settings.valueField] = input\n        return data\n      }\n      var create = once(function (data) {\n        self.unlock()\n        if (!data || typeof data !== 'object') return callback()\n        var value = hash_key(data[self.settings.valueField])\n        if (typeof value !== 'string') return callback()\n        self.setTextboxValue('')\n        self.addOption(data)\n        self.setCaret(caret)\n        self.addItem(value)\n        self.refreshOptions(triggerDropdown && self.settings.mode !== 'single')\n        callback(data)\n      })\n      var output = setup.apply(this, [input, create])\n\n      if (typeof output !== 'undefined') {\n        create(output)\n      }\n\n      return true\n    },\n\n    /**\n     * Re-renders the selected item lists.\n     */\n    refreshItems: function () {\n      this.lastQuery = null\n\n      if (this.isSetup) {\n        this.addItem(this.items)\n      }\n\n      this.refreshState()\n      this.updateOriginalInput()\n    },\n\n    /**\n     * Updates all state-dependent attributes\n     * and CSS classes.\n     */\n    refreshState: function () {\n      this.refreshValidityState()\n      this.refreshClasses()\n    },\n\n    /**\n     * Update the `required` attribute of both input and control input.\n     *\n     * The `required` property needs to be activated on the control input\n     * for the error to be displayed at the right place. `required` also\n     * needs to be temporarily deactivated on the input since the input is\n     * hidden and can't show errors.\n     */\n    refreshValidityState: function () {\n      if (!this.isRequired) return false\n      var invalid = !this.items.length\n      this.isInvalid = invalid\n      this.$control_input.prop('required', invalid)\n      this.$input.prop('required', !invalid)\n    },\n\n    /**\n     * Updates all state-dependent CSS classes.\n     */\n    refreshClasses: function () {\n      var self = this\n      var isFull = self.isFull()\n      var isLocked = self.isLocked\n      self.$wrapper.toggleClass('rtl', self.rtl)\n      self.$control.toggleClass('focus', self.isFocused).toggleClass('disabled', self.isDisabled).toggleClass('required', self.isRequired).toggleClass('invalid', self.isInvalid).toggleClass('locked', isLocked).toggleClass('full', isFull).toggleClass('not-full', !isFull).toggleClass('input-active', self.isFocused && !self.isInputHidden).toggleClass('dropdown-active', self.isOpen).toggleClass('has-options', !$.isEmptyObject(self.options)).toggleClass('has-items', self.items.length > 0)\n      self.$control_input.data('grow', !isFull && !isLocked)\n    },\n\n    /**\n     * Determines whether or not more items can be added\n     * to the control without exceeding the user-defined maximum.\n     *\n     * @returns {boolean}\n     */\n    isFull: function () {\n      return this.settings.maxItems !== null && this.items.length >= this.settings.maxItems\n    },\n\n    /**\n     * Refreshes the original <select> or <input>\n     * element to reflect the current state.\n     */\n    updateOriginalInput: function (opts) {\n      var i\n\n      var n\n\n      var options\n\n      var label\n\n      var self = this\n      opts = opts || {}\n\n      if (self.tagType === TAG_SELECT) {\n        options = []\n\n        for (i = 0, n = self.items.length; i < n; i++) {\n          label = self.options[self.items[i]][self.settings.labelField] || ''\n          options.push('<option value=\"' + escape_html(self.items[i]) + '\" selected=\"selected\">' + escape_html(label) + '</option>')\n        }\n\n        if (!options.length && !this.$input.attr('multiple')) {\n          options.push('<option value=\"\" selected=\"selected\"></option>')\n        }\n\n        self.$input.html(options.join(''))\n      } else {\n        self.$input.val(self.getValue())\n        self.$input.attr('value', self.$input.val())\n      }\n\n      if (self.isSetup) {\n        if (!opts.silent) {\n          self.trigger('change', self.$input.val())\n        }\n      }\n    },\n\n    /**\n     * Shows/hide the input placeholder depending\n     * on if there items in the list already.\n     */\n    updatePlaceholder: function () {\n      if (!this.settings.placeholder) return\n      var $input = this.$control_input\n\n      if (this.items.length) {\n        $input.removeAttr('placeholder')\n      } else {\n        $input.attr('placeholder', this.settings.placeholder)\n      }\n\n      $input.triggerHandler('update', {\n        force: true\n      })\n    },\n\n    /**\n     * Shows the autocomplete dropdown containing\n     * the available options.\n     */\n    open: function () {\n      var self = this\n      if (self.isLocked || self.isOpen || self.settings.mode === 'multi' && self.isFull()) return\n      self.focus()\n      self.isOpen = true\n      self.refreshState()\n      self.$dropdown.css({\n        visibility: 'hidden',\n        display: 'block'\n      })\n      self.positionDropdown()\n      self.$dropdown.css({\n        visibility: 'visible'\n      })\n      self.trigger('dropdown_open', self.$dropdown)\n    },\n\n    /**\n     * Closes the autocomplete dropdown menu.\n     */\n    close: function () {\n      var self = this\n      var trigger = self.isOpen\n\n      if (self.settings.mode === 'single' && self.items.length) {\n        self.hideInput() // Do not trigger blur while inside a blur event,\n        // this fixes some weird tabbing behavior in FF and IE.\n        // See #1164\n\n        if (!self.isBlurring) {\n          self.$control_input.blur() // close keyboard on iOS\n        }\n      }\n\n      self.isOpen = false\n      self.$dropdown.hide()\n      self.setActiveOption(null)\n      self.refreshState()\n      if (trigger) self.trigger('dropdown_close', self.$dropdown)\n    },\n\n    /**\n     * Calculates and applies the appropriate\n     * position of the dropdown.\n     */\n    positionDropdown: function () {\n      var $control = this.$control\n      var offset = this.settings.dropdownParent === 'body' ? $control.offset() : $control.position()\n      offset.top += $control.outerHeight(true)\n      this.$dropdown.css({\n        width: $control[0].getBoundingClientRect().width,\n        top: offset.top,\n        left: offset.left\n      })\n    },\n\n    /**\n     * Resets / clears all selected items\n     * from the control.\n     *\n     * @param {boolean} silent\n     */\n    clear: function (silent) {\n      var self = this\n      if (!self.items.length) return\n      self.$control.children(':not(input)').remove()\n      self.items = []\n      self.lastQuery = null\n      self.setCaret(0)\n      self.setActiveItem(null)\n      self.updatePlaceholder()\n      self.updateOriginalInput({\n        silent: silent\n      })\n      self.refreshState()\n      self.showInput()\n      self.trigger('clear')\n    },\n\n    /**\n     * A helper method for inserting an element\n     * at the current caret position.\n     *\n     * @param {object} $el\n     */\n    insertAtCaret: function ($el) {\n      var caret = Math.min(this.caretPos, this.items.length)\n      var el = $el[0]\n      var target = this.buffer || this.$control[0]\n\n      if (caret === 0) {\n        target.insertBefore(el, target.firstChild)\n      } else {\n        target.insertBefore(el, target.childNodes[caret])\n      }\n\n      this.setCaret(caret + 1)\n    },\n\n    /**\n     * Removes the current selected item(s).\n     *\n     * @param {object} e (optional)\n     * @returns {boolean}\n     */\n    deleteSelection: function (e) {\n      var i, n, direction, selection, values, caret, option_select, $option_select, $tail\n      var self = this\n      direction = e && e.keyCode === KEY_BACKSPACE ? -1 : 1\n      selection = getSelection(self.$control_input[0])\n\n      if (self.$activeOption && !self.settings.hideSelected) {\n        option_select = self.getAdjacentOption(self.$activeOption, -1).attr('data-value')\n      } // determine items that will be removed\n\n      values = []\n\n      if (self.$activeItems.length) {\n        $tail = self.$control.children('.active:' + (direction > 0 ? 'last' : 'first'))\n        caret = self.$control.children(':not(input)').index($tail)\n\n        if (direction > 0) {\n          caret++\n        }\n\n        for (i = 0, n = self.$activeItems.length; i < n; i++) {\n          values.push($(self.$activeItems[i]).attr('data-value'))\n        }\n\n        if (e) {\n          e.preventDefault()\n          e.stopPropagation()\n        }\n      } else if ((self.isFocused || self.settings.mode === 'single') && self.items.length) {\n        if (direction < 0 && selection.start === 0 && selection.length === 0) {\n          values.push(self.items[self.caretPos - 1])\n        } else if (direction > 0 && selection.start === self.$control_input.val().length) {\n          values.push(self.items[self.caretPos])\n        }\n      } // allow the callback to abort\n\n      if (!values.length || typeof self.settings.onDelete === 'function' && self.settings.onDelete.apply(self, [values]) === false) {\n        return false\n      } // perform removal\n\n      if (typeof caret !== 'undefined') {\n        self.setCaret(caret)\n      }\n\n      while (values.length) {\n        self.removeItem(values.pop())\n      }\n\n      self.showInput()\n      self.positionDropdown()\n      self.refreshOptions(true) // select previous option\n\n      if (option_select) {\n        $option_select = self.getOption(option_select)\n\n        if ($option_select.length) {\n          self.setActiveOption($option_select)\n        }\n      }\n\n      return true\n    },\n\n    /**\n     * Selects the previous / next item (depending\n     * on the `direction` argument).\n     *\n     * > 0 - right\n     * < 0 - left\n     *\n     * @param {int} direction\n     * @param {object} e (optional)\n     */\n    advanceSelection: function (direction, e) {\n      var tail, selection, idx, valueLength, cursorAtEdge, $tail\n      var self = this\n      if (direction === 0) return\n      if (self.rtl) direction *= -1\n      tail = direction > 0 ? 'last' : 'first'\n      selection = getSelection(self.$control_input[0])\n\n      if (self.isFocused && !self.isInputHidden) {\n        valueLength = self.$control_input.val().length\n        cursorAtEdge = direction < 0 ? selection.start === 0 && selection.length === 0 : selection.start === valueLength\n\n        if (cursorAtEdge && !valueLength) {\n          self.advanceCaret(direction, e)\n        }\n      } else {\n        $tail = self.$control.children('.active:' + tail)\n\n        if ($tail.length) {\n          idx = self.$control.children(':not(input)').index($tail)\n          self.setActiveItem(null)\n          self.setCaret(direction > 0 ? idx + 1 : idx)\n        }\n      }\n    },\n\n    /**\n     * Moves the caret left / right.\n     *\n     * @param {int} direction\n     * @param {object} e (optional)\n     */\n    advanceCaret: function (direction, e) {\n      var self = this\n\n      var fn\n\n      var $adj\n      if (direction === 0) return\n      fn = direction > 0 ? 'next' : 'prev'\n\n      if (self.isShiftDown) {\n        $adj = self.$control_input[fn]()\n\n        if ($adj.length) {\n          self.hideInput()\n          self.setActiveItem($adj)\n          e && e.preventDefault()\n        }\n      } else {\n        self.setCaret(self.caretPos + direction)\n      }\n    },\n\n    /**\n     * Moves the caret to the specified index.\n     *\n     * @param {int} i\n     */\n    setCaret: function (i) {\n      var self = this\n\n      if (self.settings.mode === 'single') {\n        i = self.items.length\n      } else {\n        i = Math.max(0, Math.min(self.items.length, i))\n      }\n\n      if (!self.isPending) {\n        // the input must be moved by leaving it in place and moving the\n        // siblings, due to the fact that focus cannot be restored once lost\n        // on mobile webkit devices\n        var j, n, fn, $children, $child\n        $children = self.$control.children(':not(input)')\n\n        for (j = 0, n = $children.length; j < n; j++) {\n          $child = $($children[j]).detach()\n\n          if (j < i) {\n            self.$control_input.before($child)\n          } else {\n            self.$control.append($child)\n          }\n        }\n      }\n\n      self.caretPos = i\n    },\n\n    /**\n     * Disables user input on the control. Used while\n     * items are being asynchronously created.\n     */\n    lock: function () {\n      this.close()\n      this.isLocked = true\n      this.refreshState()\n    },\n\n    /**\n     * Re-enables user input on the control.\n     */\n    unlock: function () {\n      this.isLocked = false\n      this.refreshState()\n    },\n\n    /**\n     * Disables user input on the control completely.\n     * While disabled, it cannot receive focus.\n     */\n    disable: function () {\n      var self = this\n      self.$input.prop('disabled', true)\n      self.$control_input.prop('disabled', true).prop('tabindex', -1)\n      self.isDisabled = true\n      self.lock()\n    },\n\n    /**\n     * Enables the control so that it can respond\n     * to focus and user input.\n     */\n    enable: function () {\n      var self = this\n      self.$input.prop('disabled', false)\n      self.$control_input.prop('disabled', false).prop('tabindex', self.tabIndex)\n      self.isDisabled = false\n      self.unlock()\n    },\n\n    /**\n     * Completely destroys the control and\n     * unbinds all event listeners so that it can\n     * be garbage collected.\n     */\n    destroy: function () {\n      var self = this\n      var eventNS = self.eventNS\n      var revertSettings = self.revertSettings\n      self.trigger('destroy')\n      self.off()\n      self.$wrapper.remove()\n      self.$dropdown.remove()\n      self.$input.html('').append(revertSettings.$children).removeAttr('tabindex').removeClass('selectized').attr({\n        tabindex: revertSettings.tabindex\n      }).show()\n      self.$control_input.removeData('grow')\n      self.$input.removeData('selectize')\n\n      if (--Selectize.count == 0 && Selectize.$testInput) {\n        Selectize.$testInput.remove()\n        Selectize.$testInput = undefined\n      }\n\n      $(window).off(eventNS)\n      $(document).off(eventNS)\n      $(document.body).off(eventNS)\n      delete self.$input[0].selectize\n    },\n\n    /**\n     * A helper method for rendering \"item\" and\n     * \"option\" templates, given the data.\n     *\n     * @param {string} templateName\n     * @param {object} data\n     * @returns {string}\n     */\n    render: function (templateName, data) {\n      var value, id, label\n      var html = ''\n      var cache = false\n      var self = this\n      var regex_tag = /^[\\t \\r\\n]*<([a-z][a-z0-9\\-_]*(?:\\:[a-z][a-z0-9\\-_]*)?)/i\n\n      if (templateName === 'option' || templateName === 'item') {\n        value = hash_key(data[self.settings.valueField])\n        cache = !!value\n      } // pull markup from cache if it exists\n\n      if (cache) {\n        if (!isset(self.renderCache[templateName])) {\n          self.renderCache[templateName] = {}\n        }\n\n        if (self.renderCache[templateName].hasOwnProperty(value)) {\n          return self.renderCache[templateName][value]\n        }\n      } // render markup\n\n      html = $(self.settings.render[templateName].apply(this, [data, escape_html])) // add mandatory attributes\n\n      if (templateName === 'option' || templateName === 'option_create') {\n        if (!data[self.settings.disabledField]) {\n          html.attr('data-selectable', '')\n        }\n      } else if (templateName === 'optgroup') {\n        id = data[self.settings.optgroupValueField] || ''\n        html.attr('data-group', id)\n\n        if (data[self.settings.disabledField]) {\n          html.attr('data-disabled', '')\n        }\n      }\n\n      if (templateName === 'option' || templateName === 'item') {\n        html.attr('data-value', value || '')\n      } // update cache\n\n      if (cache) {\n        self.renderCache[templateName][value] = html[0]\n      }\n\n      return html[0]\n    },\n\n    /**\n     * Clears the render cache for a template. If\n     * no template is given, clears all render\n     * caches.\n     *\n     * @param {string} templateName\n     */\n    clearCache: function (templateName) {\n      var self = this\n\n      if (typeof templateName === 'undefined') {\n        self.renderCache = {}\n      } else {\n        delete self.renderCache[templateName]\n      }\n    },\n\n    /**\n     * Determines whether or not to display the\n     * create item prompt, given a user input.\n     *\n     * @param {string} input\n     * @return {boolean}\n     */\n    canCreate: function (input) {\n      var self = this\n      if (!self.settings.create) return false\n      var filter = self.settings.createFilter\n      return input.length && (typeof filter !== 'function' || filter.apply(self, [input])) && (typeof filter !== 'string' || new RegExp(filter).test(input)) && (!(filter instanceof RegExp) || filter.test(input))\n    }\n  })\n  Selectize.count = 0\n  Selectize.defaults = {\n    options: [],\n    optgroups: [],\n    plugins: [],\n    delimiter: ',',\n    splitOn: null,\n    // regexp or string for splitting up values from a paste command\n    persist: true,\n    diacritics: true,\n    create: false,\n    createOnBlur: false,\n    createFilter: null,\n    highlight: true,\n    openOnFocus: true,\n    maxOptions: 1000,\n    maxItems: null,\n    hideSelected: null,\n    addPrecedence: false,\n    selectOnTab: false,\n    preload: false,\n    allowEmptyOption: false,\n    closeAfterSelect: false,\n    scrollDuration: 60,\n    loadThrottle: 300,\n    loadingClass: 'loading',\n    dataAttr: 'data-data',\n    optgroupField: 'optgroup',\n    valueField: 'value',\n    labelField: 'text',\n    disabledField: 'disabled',\n    optgroupLabelField: 'label',\n    optgroupValueField: 'value',\n    lockOptgroupOrder: false,\n    sortField: '$order',\n    searchField: ['text'],\n    searchConjunction: 'and',\n    mode: null,\n    wrapperClass: 'selectize-control',\n    inputClass: 'selectize-input',\n    dropdownClass: 'selectize-dropdown',\n    dropdownContentClass: 'selectize-dropdown-content',\n    dropdownParent: null,\n    copyClassesToDropdown: true,\n\n    /*\n    load                 : null, // function(query, callback) { ... }\n    score                : null, // function(search) { ... }\n    onInitialize         : null, // function() { ... }\n    onChange             : null, // function(value) { ... }\n    onItemAdd            : null, // function(value, $item) { ... }\n    onItemRemove         : null, // function(value) { ... }\n    onClear              : null, // function() { ... }\n    onOptionAdd          : null, // function(value, data) { ... }\n    onOptionRemove       : null, // function(value) { ... }\n    onOptionClear        : null, // function() { ... }\n    onOptionGroupAdd     : null, // function(id, data) { ... }\n    onOptionGroupRemove  : null, // function(id) { ... }\n    onOptionGroupClear   : null, // function() { ... }\n    onDropdownOpen       : null, // function($dropdown) { ... }\n    onDropdownClose      : null, // function($dropdown) { ... }\n    onType               : null, // function(str) { ... }\n    onDelete             : null, // function(values) { ... }\n    */\n    render: {\n      /*\n      item: null,\n      optgroup: null,\n      optgroup_header: null,\n      option: null,\n      option_create: null\n      */\n    }\n  }\n\n  $.fn.selectize = function (settings_user) {\n    var defaults = $.fn.selectize.defaults\n    var settings = $.extend({}, defaults, settings_user)\n    var attr_data = settings.dataAttr\n    var field_label = settings.labelField\n    var field_value = settings.valueField\n    var field_disabled = settings.disabledField\n    var field_optgroup = settings.optgroupField\n    var field_optgroup_label = settings.optgroupLabelField\n    var field_optgroup_value = settings.optgroupValueField\n    /**\n     * Initializes selectize from a <input type=\"text\"> element.\n     *\n     * @param {object} $input\n     * @param {object} settings_element\n     */\n\n    var init_textbox = function ($input, settings_element) {\n      var i, n, values, option\n      var data_raw = $input.attr(attr_data)\n\n      if (!data_raw) {\n        var value = $.trim($input.val() || '')\n        if (!settings.allowEmptyOption && !value.length) return\n        values = value.split(settings.delimiter)\n\n        for (i = 0, n = values.length; i < n; i++) {\n          option = {}\n          option[field_label] = values[i]\n          option[field_value] = values[i]\n          settings_element.options.push(option)\n        }\n\n        settings_element.items = values\n      } else {\n        settings_element.options = JSON.parse(data_raw)\n\n        for (i = 0, n = settings_element.options.length; i < n; i++) {\n          settings_element.items.push(settings_element.options[i][field_value])\n        }\n      }\n    }\n    /**\n     * Initializes selectize from a <select> element.\n     *\n     * @param {object} $input\n     * @param {object} settings_element\n     */\n\n    var init_select = function ($input, settings_element) {\n      var i\n\n      var n\n\n      var tagName\n\n      var $children\n\n      var order = 0\n      var options = settings_element.options\n      var optionsMap = {}\n\n      var readData = function ($el) {\n        var data = attr_data && $el.attr(attr_data)\n\n        if (typeof data === 'string' && data.length) {\n          return JSON.parse(data)\n        }\n\n        return null\n      }\n\n      var addOption = function ($option, group) {\n        $option = $($option)\n        var value = hash_key($option.val())\n        if (!value && !settings.allowEmptyOption) return // if the option already exists, it's probably been\n        // duplicated in another optgroup. in this case, push\n        // the current group to the \"optgroup\" property on the\n        // existing option so that it's rendered in both places.\n\n        if (optionsMap.hasOwnProperty(value)) {\n          if (group) {\n            var arr = optionsMap[value][field_optgroup]\n\n            if (!arr) {\n              optionsMap[value][field_optgroup] = group\n            } else if (!$.isArray(arr)) {\n              optionsMap[value][field_optgroup] = [arr, group]\n            } else {\n              arr.push(group)\n            }\n          }\n\n          return\n        }\n\n        var option = readData($option) || {}\n        option[field_label] = option[field_label] || $option.text()\n        option[field_value] = option[field_value] || value\n        option[field_disabled] = option[field_disabled] || $option.prop('disabled')\n        option[field_optgroup] = option[field_optgroup] || group\n        optionsMap[value] = option\n        options.push(option)\n\n        if ($option.is(':selected')) {\n          settings_element.items.push(value)\n        }\n      }\n\n      var addGroup = function ($optgroup) {\n        var i, n, id, optgroup, $options\n        $optgroup = $($optgroup)\n        id = $optgroup.attr('label')\n\n        if (id) {\n          optgroup = readData($optgroup) || {}\n          optgroup[field_optgroup_label] = id\n          optgroup[field_optgroup_value] = id\n          optgroup[field_disabled] = $optgroup.prop('disabled')\n          settings_element.optgroups.push(optgroup)\n        }\n\n        $options = $('option', $optgroup)\n\n        for (i = 0, n = $options.length; i < n; i++) {\n          addOption($options[i], id)\n        }\n      }\n\n      settings_element.maxItems = $input.attr('multiple') ? null : 1\n      $children = $input.children()\n\n      for (i = 0, n = $children.length; i < n; i++) {\n        tagName = $children[i].tagName.toLowerCase()\n\n        if (tagName === 'optgroup') {\n          addGroup($children[i])\n        } else if (tagName === 'option') {\n          addOption($children[i])\n        }\n      }\n    }\n\n    return this.each(function () {\n      if (this.selectize) return\n      var instance\n      var $input = $(this)\n      var tag_name = this.tagName.toLowerCase()\n      var placeholder = $input.attr('placeholder') || $input.attr('data-placeholder')\n\n      if (!placeholder && !settings.allowEmptyOption) {\n        placeholder = $input.children('option[value=\"\"]').text()\n      }\n\n      var settings_element = {\n        'placeholder': placeholder,\n        'options': [],\n        'optgroups': [],\n        'items': []\n      }\n\n      if (tag_name === 'select') {\n        init_select($input, settings_element)\n      } else {\n        init_textbox($input, settings_element)\n      }\n\n      instance = new Selectize($input, $.extend(true, {}, defaults, settings_element, settings_user))\n    })\n  }\n\n  $.fn.selectize.defaults = Selectize.defaults\n  $.fn.selectize.support = {\n    validity: SUPPORTS_VALIDITY_API\n  }\n  Selectize.define('drag_drop', function (options) {\n    if (!$.fn.sortable) throw new Error('The \"drag_drop\" plugin requires jQuery UI \"sortable\".')\n    if (this.settings.mode !== 'multi') return\n    var self = this\n\n    self.lock = (function () {\n      var original = self.lock\n      return function () {\n        var sortable = self.$control.data('sortable')\n        if (sortable) sortable.disable()\n        return original.apply(self, arguments)\n      }\n    }())\n\n    self.unlock = (function () {\n      var original = self.unlock\n      return function () {\n        var sortable = self.$control.data('sortable')\n        if (sortable) sortable.enable()\n        return original.apply(self, arguments)\n      }\n    }())\n\n    self.setup = (function () {\n      var original = self.setup\n      return function () {\n        original.apply(this, arguments)\n        var $control = self.$control.sortable({\n          items: '[data-value]',\n          forcePlaceholderSize: true,\n          disabled: self.isLocked,\n          start: function (e, ui) {\n            ui.placeholder.css('width', ui.helper.css('width'))\n            $control.css({\n              overflow: 'visible'\n            })\n          },\n          stop: function () {\n            $control.css({\n              overflow: 'hidden'\n            })\n            var active = self.$activeItems ? self.$activeItems.slice() : null\n            var values = []\n            $control.children('[data-value]').each(function () {\n              values.push($(this).attr('data-value'))\n            })\n            self.setValue(values)\n            self.setActiveItem(active)\n          }\n        })\n      }\n    }())\n  })\n  Selectize.define('dropdown_header', function (options) {\n    var self = this\n    options = $.extend({\n      title: 'Untitled',\n      headerClass: 'selectize-dropdown-header',\n      titleRowClass: 'selectize-dropdown-header-title',\n      labelClass: 'selectize-dropdown-header-label',\n      closeClass: 'selectize-dropdown-header-close',\n      html: function (data) {\n        return '<div class=\"' + data.headerClass + '\">' + '<div class=\"' + data.titleRowClass + '\">' + '<span class=\"' + data.labelClass + '\">' + data.title + '</span>' + '<a href=\"javascript:void(0)\" class=\"' + data.closeClass + '\">&times;</a>' + '</div>' + '</div>'\n      }\n    }, options)\n\n    self.setup = (function () {\n      var original = self.setup\n      return function () {\n        original.apply(self, arguments)\n        self.$dropdown_header = $(options.html(options))\n        self.$dropdown.prepend(self.$dropdown_header)\n      }\n    }())\n  })\n  Selectize.define('optgroup_columns', function (options) {\n    var self = this\n    options = $.extend({\n      equalizeWidth: true,\n      equalizeHeight: true\n    }, options)\n\n    this.getAdjacentOption = function ($option, direction) {\n      var $options = $option.closest('[data-group]').find('[data-selectable]')\n      var index = $options.index($option) + direction\n      return index >= 0 && index < $options.length ? $options.eq(index) : $()\n    }\n\n    this.onKeyDown = (function () {\n      var original = self.onKeyDown\n      return function (e) {\n        var index, $option, $options, $optgroup\n\n        if (this.isOpen && (e.keyCode === KEY_LEFT || e.keyCode === KEY_RIGHT)) {\n          self.ignoreHover = true\n          $optgroup = this.$activeOption.closest('[data-group]')\n          index = $optgroup.find('[data-selectable]').index(this.$activeOption)\n\n          if (e.keyCode === KEY_LEFT) {\n            $optgroup = $optgroup.prev('[data-group]')\n          } else {\n            $optgroup = $optgroup.next('[data-group]')\n          }\n\n          $options = $optgroup.find('[data-selectable]')\n          $option = $options.eq(Math.min($options.length - 1, index))\n\n          if ($option.length) {\n            this.setActiveOption($option)\n          }\n\n          return\n        }\n\n        return original.apply(this, arguments)\n      }\n    }())\n\n    var getScrollbarWidth = function () {\n      var div\n      var width = getScrollbarWidth.width\n      var doc = document\n\n      if (typeof width === 'undefined') {\n        div = doc.createElement('div')\n        div.innerHTML = '<div style=\"width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;\"><div style=\"width:1px;height:100px;\"></div></div>'\n        div = div.firstChild\n        doc.body.appendChild(div)\n        width = getScrollbarWidth.width = div.offsetWidth - div.clientWidth\n        doc.body.removeChild(div)\n      }\n\n      return width\n    }\n\n    var equalizeSizes = function () {\n      var i, n, height_max, width, width_last, width_parent, $optgroups\n      $optgroups = $('[data-group]', self.$dropdown_content)\n      n = $optgroups.length\n      if (!n || !self.$dropdown_content.width()) return\n\n      if (options.equalizeHeight) {\n        height_max = 0\n\n        for (i = 0; i < n; i++) {\n          height_max = Math.max(height_max, $optgroups.eq(i).height())\n        }\n\n        $optgroups.css({\n          height: height_max\n        })\n      }\n\n      if (options.equalizeWidth) {\n        width_parent = self.$dropdown_content.innerWidth() - getScrollbarWidth()\n        width = Math.round(width_parent / n)\n        $optgroups.css({\n          width: width\n        })\n\n        if (n > 1) {\n          width_last = width_parent - width * (n - 1)\n          $optgroups.eq(n - 1).css({\n            width: width_last\n          })\n        }\n      }\n    }\n\n    if (options.equalizeHeight || options.equalizeWidth) {\n      hook.after(this, 'positionDropdown', equalizeSizes)\n      hook.after(this, 'refreshOptions', equalizeSizes)\n    }\n  })\n  Selectize.define('remove_button', function (options) {\n    options = $.extend({\n      label: '&times;',\n      title: 'Remove',\n      className: 'remove',\n      append: true\n    }, options)\n\n    var singleClose = function (thisRef, options) {\n      options.className = 'remove-single'\n      var self = thisRef\n      var html = '<a href=\"javascript:void(0)\" class=\"' + options.className + '\" tabindex=\"-1\" title=\"' + escape_html(options.title) + '\">' + options.label + '</a>'\n      /**\n       * Appends an element as a child (with raw HTML).\n       *\n       * @param {string} html_container\n       * @param {string} html_element\n       * @return {string}\n       */\n\n      var append = function (html_container, html_element) {\n        return $('<span>').append(html_container).append(html_element)\n      }\n\n      thisRef.setup = (function () {\n        var original = self.setup\n        return function () {\n          // override the item rendering method to add the button to each\n          if (options.append) {\n            var id = $(self.$input.context).attr('id')\n            var selectizer = $('#' + id)\n            var render_item = self.settings.render.item\n\n            self.settings.render.item = function (data) {\n              return append(render_item.apply(thisRef, arguments), html)\n            }\n          }\n\n          original.apply(thisRef, arguments) // add event listener\n\n          thisRef.$control.on('click', '.' + options.className, function (e) {\n            e.preventDefault()\n            if (self.isLocked) return\n            self.clear()\n          })\n        }\n      }())\n    }\n\n    var multiClose = function (thisRef, options) {\n      var self = thisRef\n      var html = '<a href=\"javascript:void(0)\" class=\"' + options.className + '\" tabindex=\"-1\" title=\"' + escape_html(options.title) + '\">' + options.label + '</a>'\n      /**\n       * Appends an element as a child (with raw HTML).\n       *\n       * @param {string} html_container\n       * @param {string} html_element\n       * @return {string}\n       */\n\n      var append = function (html_container, html_element) {\n        var pos = html_container.search(/(<\\/[^>]+>\\s*)$/)\n        return html_container.substring(0, pos) + html_element + html_container.substring(pos)\n      }\n\n      thisRef.setup = (function () {\n        var original = self.setup\n        return function () {\n          // override the item rendering method to add the button to each\n          if (options.append) {\n            var render_item = self.settings.render.item\n\n            self.settings.render.item = function (data) {\n              return append(render_item.apply(thisRef, arguments), html)\n            }\n          }\n\n          original.apply(thisRef, arguments) // add event listener\n\n          thisRef.$control.on('click', '.' + options.className, function (e) {\n            e.preventDefault()\n            if (self.isLocked) return\n            var $item = $(e.currentTarget).parent()\n            self.setActiveItem($item)\n\n            if (self.deleteSelection()) {\n              self.setCaret(self.items.length)\n            }\n          })\n        }\n      }())\n    }\n\n    if (this.settings.mode === 'single') {\n      singleClose(this, options)\n    } else {\n      multiClose(this, options)\n    }\n  })\n  Selectize.define('restore_on_backspace', function (options) {\n    var self = this\n\n    options.text = options.text || function (option) {\n      return option[this.settings.labelField]\n    }\n\n    this.onKeyDown = (function () {\n      var original = self.onKeyDown\n      return function (e) {\n        var index, option\n\n        if (e.keyCode === KEY_BACKSPACE && this.$control_input.val() === '' && !this.$activeItems.length) {\n          index = this.caretPos - 1\n\n          if (index >= 0 && index < this.items.length) {\n            option = this.options[this.items[index]]\n\n            if (this.deleteSelection(e)) {\n              this.setTextboxValue(options.text.apply(this, [option]))\n              this.refreshOptions(true)\n            }\n\n            e.preventDefault()\n            return\n          }\n        }\n\n        return original.apply(this, arguments)\n      }\n    }())\n  })\n  return Selectize\n})\n// # sourceMappingURL=selectize.js.map\n"],"file":"selectize.js"}